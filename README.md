<div align="center">

# ğŸ’° CuentasSiK

**Sistema profesional de gestiÃ³n de gastos compartidos para parejas**

[![Version](https://img.shields.io/badge/version-1.0.0-blue?style=flat-square)](https://github.com/Kavalieri/CuentasSiK/releases)
[![TypeScript](https://img.shields.io/badge/TypeScript-5.0-blue?logo=typescript&style=flat-square)](https://www.typescriptlang.org/)
[![Next.js](https://img.shields.io/badge/Next.js-14+-black?logo=next.js&style=flat-square)](https://nextjs.org/)
[![PostgreSQL](https://img.shields.io/badge/PostgreSQL-15+-blue?logo=postgresql&style=flat-square)](https://postgresql.org/)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg?style=flat-square)](./LICENSE)

[ğŸŒ **Demo en Vivo**](https://cuentassik.com) Â· [ğŸ“– **DocumentaciÃ³n**](./docs) Â· [ğŸ› **Reportar Bug**](https://github.com/Kavalieri/CuentasSiK/issues) Â· [ğŸ’¡ **Solicitar Feature**](https://github.com/Kavalieri/CuentasSiK/issues)

</div>

---

## ï¿½ Â¿QuÃ© es CuentasSiK?

**CuentasSiK** es una aplicaciÃ³n web moderna y profesional diseÃ±ada especÃ­ficamente para parejas que desean gestionar sus finanzas compartidas de manera transparente, equitativa y sin complicaciones.

### ğŸ¯ **Problema que resuelve**

- âŒ **Discusiones por dinero**: Â¿QuiÃ©n debe pagar quÃ©?
- âŒ **CÃ¡lculos manuales**: Hojas de cÃ¡lculo desactualizadas
- âŒ **Falta de transparencia**: No saber en quÃ© se gasta el dinero
- âŒ **Inequidad financiera**: Contribuciones desproporcionadas a los ingresos

### âœ… **Nuestra soluciÃ³n**

CuentasSiK ofrece un sistema de **contribuciones proporcionales inteligente** que:

- **Calcula automÃ¡ticamente** la parte que debe pagar cada miembro segÃºn sus ingresos
- **Registra todos los gastos** con categorizaciÃ³n y filtros avanzados
- **Gestiona crÃ©ditos automÃ¡ticamente** cuando alguien paga de mÃ¡s
- **Mantiene un fondo de ahorros compartido** para metas conjuntas
- **Genera reportes** detallados de gastos e ingresos

---

## âœ¨ CaracterÃ­sticas Principales

### ğŸ” **AutenticaciÃ³n & GestiÃ³n de Hogares**

- âœ… **Magic Link Authentication**: Sin contraseÃ±as, solo email
- âœ… **Sistema Multi-Hogar**: Gestiona mÃºltiples hogares independientes
- âœ… **Invitaciones Seguras**: Enlaces temporales para invitar miembros
- âœ… **Selector de Contexto**: Cambio rÃ¡pido entre hogares

### ğŸ’¸ **GestiÃ³n Avanzada de Transacciones**

- âœ… **CRUD Completo**: Crear, editar, eliminar con validaciones
- âœ… **23+ CategorÃ­as**: CategorÃ­as predefinidas + personalizaciÃ³n
- âœ… **Filtros Inteligentes**: Por categorÃ­a, tipo, fecha, miembro, estado
- âœ… **Historial de Cambios**: AuditorÃ­a completa de modificaciones
- âœ… **Privacy Mode**: Ocultar cantidades en lugares pÃºblicos

### ğŸ¤ **Sistema de Contribuciones Proporcionales**

- âœ… **CÃ¡lculo AutomÃ¡tico**: Proporcional a ingresos, partes iguales o personalizado
- âœ… **Workflow de AprobaciÃ³n**: Sistema completo de ajustes con aprobaciÃ³n/rechazo
- âœ… **Estados DinÃ¡micos**: pending, partial, paid, overpaid con tracking en tiempo real
- âœ… **Panel de GestiÃ³n**: Interface dedicada para owners con contador de pendientes
- âœ… **Transacciones Duales**: Ajustes crean automÃ¡ticamente gasto + ingreso virtual

### ğŸ’³ **Sistema Inteligente de CrÃ©ditos**

- âœ… **GeneraciÃ³n AutomÃ¡tica**: CrÃ©ditos por sobrepagos automÃ¡ticos
- âœ… **DecisiÃ³n Flexible**: Aplicar al mes siguiente o transferir a ahorros
- âœ… **GestiÃ³n Mensual**: Decisiones independientes cada mes
- âœ… **Reserva Temporal**: Sistema de reserva para evitar doble uso

### ğŸ’° **Fondo de Ahorros Compartido**

- âœ… **DepÃ³sitos**: Desde cuenta personal al fondo comÃºn
- âœ… **Retiros**: Del fondo comÃºn a cuenta personal
- âœ… **Transferencias de CrÃ©ditos**: Convierte crÃ©ditos en ahorros
- âœ… **GrÃ¡ficos de EvoluciÃ³n**: VisualizaciÃ³n del crecimiento del fondo
- âœ… **Historial Completo**: Todas las operaciones registradas

### ğŸ“Š **Reportes y AnÃ¡lisis**

- âœ… **Dashboard Interactivo**: 3 pestaÃ±as (Balance, Ahorro, EstadÃ­sticas)
- âœ… **Balance Breakdown**: AnÃ¡lisis detallado por categorÃ­as
- âœ… **GrÃ¡ficos Evolutivos**: EvoluciÃ³n de ahorros en el tiempo
- âœ… **ExportaciÃ³n**: PDF y CSV con datos completos
- âœ… **PerÃ­odos Mensuales**: GestiÃ³n temporal con cierre/reapertura

### âš™ï¸ **AdministraciÃ³n y ConfiguraciÃ³n**

- âœ… **Panel de Admin**: Para administradores del sistema
- âœ… **GestiÃ³n de Miembros**: Roles owner/member con permisos diferenciados
- âœ… **ConfiguraciÃ³n de Hogar**: PersonalizaciÃ³n de cÃ¡lculos y categorÃ­as
- âœ… **Temas**: Modo oscuro/claro automÃ¡tico
- âœ… **Responsive**: Optimizado para mÃ³vil, tablet y desktop

---

## ğŸ—ï¸ **Stack TecnolÃ³gico**

### **Frontend**

- **Next.js 14+** con App Router y Server Actions
- **React 18+** con hooks modernos
- **TypeScript** estricto para type safety
- **Tailwind CSS** + **shadcn/ui** para diseÃ±o moderno
- **next-themes** para tema oscuro/claro

### **Backend**

- **PostgreSQL** nativo (no Supabase) para mÃ¡ximo rendimiento
- **Server Actions** de Next.js para APIs type-safe
- **Middleware** personalizado para autenticaciÃ³n
- **ValidaciÃ³n con Zod** en cliente y servidor

### **Infraestructura**

- **PM2** para gestiÃ³n de procesos en producciÃ³n
- **Servidor Linux** propio (no serverless)
- **Sistema de migraciones** personalizado
- **Backup automÃ¡tico** de base de datos

### **Desarrollo**

- **VSCode** con extensiones optimizadas
- **MCPs (Model Context Protocol)** para herramientas AI
- **Vitest** para testing unitario
- **release-please** para gestiÃ³n automÃ¡tica de versiones
- **Git hooks** para calidad de cÃ³digo

---

## ğŸš¦ **Estado del Proyecto**

### âœ… **VersiÃ³n 1.0.0 - LANZAMIENTO OFICIAL**

**ğŸ‰ Â¡Primera versiÃ³n estable!** Todas las funcionalidades core implementadas y probadas en producciÃ³n.

**ğŸ“‹ Funcionalidades Incluidas:**

- âœ… Sistema completo de autenticaciÃ³n multi-hogar
- âœ… GestiÃ³n avanzada de transacciones con filtros
- âœ… Sistema de contribuciones proporcionales con aprobaciÃ³n
- âœ… Sistema inteligente de crÃ©ditos automÃ¡ticos
- âœ… Fondo de ahorros compartido con grÃ¡ficos
- âœ… Dashboard interactivo con 3 pestaÃ±as
- âœ… ExportaciÃ³n PDF/CSV
- âœ… Panel de administraciÃ³n
- âœ… Modo oscuro/claro
- âœ… Responsive design completo

**ğŸ“Š MÃ©tricas:**

- ğŸ”¢ **+15 tablas** de base de datos optimizadas
- ğŸ¨ **+50 componentes** React reutilizables
- ğŸ“± **+20 pÃ¡ginas** responsive
- âš¡ **+30 Server Actions** type-safe
- ğŸ§ª **+100 casos de prueba** en desarrollo

---

## ğŸ¯ **Casos de Uso TÃ­picos**

### ğŸ‘« **Pareja viviendo juntos**

```
ğŸ“Š ConfiguraciÃ³n:
- Alex: â‚¬2,000/mes â†’ 60% de contribuciÃ³n
- Sam: â‚¬1,333/mes â†’ 40% de contribuciÃ³n

ğŸ’¸ Flujo mensual:
1. Gastos del hogar: â‚¬1,200
2. Alex debe: â‚¬720 (60%)
3. Sam debe: â‚¬480 (40%)
4. Seguimiento automÃ¡tico de pagos
5. CrÃ©ditos por sobrepagos gestionados automÃ¡ticamente
```

### ğŸ  **Gastos compartidos de vivienda**

```
ğŸ·ï¸ CategorÃ­as automÃ¡ticas:
- Vivienda: Alquiler, servicios, mantenimiento
- AlimentaciÃ³n: Supermercado, restaurantes
- Transporte: Combustible, transporte pÃºblico
- Ocio: Entretenimiento, suscripciones
- Salud: Seguros, mÃ©dicos
- + 18 categorÃ­as mÃ¡s personalizables
```

### ğŸ’° **Ahorro para objetivos conjuntos**

```
ğŸ¯ Metas tÃ­picas:
- Vacaciones de verano: â‚¬3,000
- ElectrodomÃ©sticos: â‚¬1,500
- Fondo de emergencia: â‚¬5,000
- Entrada para vivienda: â‚¬20,000

ğŸ“ˆ GestiÃ³n automÃ¡tica:
- DepÃ³sitos programados
- Transferencia de crÃ©ditos
- VisualizaciÃ³n del progreso
- Retiros cuando sea necesario
```

---

## ğŸš€ **InstalaciÃ³n y Despliegue**

### ğŸ“‹ **Requisitos**

- **Node.js** 18+ y npm/yarn
- **PostgreSQL** 15+
- **Git** para control de versiones

### ğŸ”§ **InstalaciÃ³n Local**

```bash
# 1. Clonar repositorio
git clone https://github.com/Kavalieri/CuentasSiK.git
cd CuentasSiK

# 2. Instalar dependencias
npm install

# 3. Configurar base de datos
# Ver documentaciÃ³n en ./database/README.md

# 4. Configurar variables de entorno
cp .env.example .env.local
# Editar .env.local con tus configuraciones

# 5. Ejecutar migraciones
npm run db:migrate

# 6. Iniciar desarrollo
npm run dev
```

### ğŸŒ **Despliegue en ProducciÃ³n**

```bash
# 1. Build de producciÃ³n
npm run build

# 2. Configurar PM2 (recomendado)
cp ecosystem.config.example.js ecosystem.config.js
# Editar configuraciÃ³n segÃºn tu servidor

# 3. Iniciar con PM2
pm2 start ecosystem.config.js
pm2 save
pm2 startup
```

**ğŸ“š DocumentaciÃ³n completa**: Ver [/docs/README.md](./docs/README.md)

---

## ğŸ¤ **Contribuir**

Â¡Contribuciones son bienvenidas! Por favor lee [CONTRIBUTING.md](./CONTRIBUTING.md) para detalles.

### ğŸ› **Reportar Bugs**

- Usa el [Issue Tracker](https://github.com/Kavalieri/CuentasSiK/issues)
- Incluye pasos para reproducir
- Especifica versiÃ³n y navegador

### ğŸ’¡ **Solicitar Features**

- Crea un [Feature Request](https://github.com/Kavalieri/CuentasSiK/issues)
- Explica el caso de uso
- Proporciona mockups si es posible

### ğŸ“ **Pull Requests**

- Fork el repositorio
- Crea una rama feature (`git checkout -b feature/AmazingFeature`)
- Commit cambios (`git commit -m 'Add AmazingFeature'`)
- Push a la rama (`git push origin feature/AmazingFeature`)
- Abre un Pull Request

---

## ğŸ“„ **Licencia**

Este proyecto estÃ¡ bajo la Licencia MIT. Ver [LICENSE](./LICENSE) para mÃ¡s detalles.

---

## ğŸ‘¥ **Equipo**

### ğŸ’» **Desarrollado por**

- **[Kavalieri](https://github.com/Kavalieri)** - Architect & Full-Stack Developer

### ğŸ¤– **Asistencia AI**

- **GitHub Copilot** - Code generation y pair programming
- **Claude 3.5 Sonnet** - Architecture design y code review

---

## ğŸ“ **Soporte**

### ğŸ’¬ **Contacto**

- ğŸ“§ **Email**: [soporte@cuentassik.com](mailto:soporte@cuentassik.com)
- ğŸ› **Issues**: [GitHub Issues](https://github.com/Kavalieri/CuentasSiK/issues)
- ğŸ“– **Wiki**: [GitHub Wiki](https://github.com/Kavalieri/CuentasSiK/wiki)

### ğŸŒŸ **Â¿Te gusta el proyecto?**

- â­ Dale una estrella en GitHub
- ğŸ› Reporta bugs que encuentres
- ğŸ’¡ Sugiere nuevas funcionalidades
- ğŸ“¢ CompÃ¡rtelo con otros

---

<div align="center">

### ğŸ’ **Hecho con amor para parejas que quieren gestionar sus finanzas juntos**

**CuentasSiK v1.0.0** - Sistema profesional de gestiÃ³n de gastos compartidos

[â¬†ï¸ Volver arriba](#-cuentassik)

</div>
- âœ… **Auto-Apply**: OpciÃ³n de aplicaciÃ³n automÃ¡tica mensual
- âœ… **Rastreo Completo**: Origen, estado y trazabilidad de cada crÃ©dito

### ğŸ’° Fondo de Ahorro del Hogar

- âœ… **Balance Compartido**: Fondo comÃºn con meta de ahorro opcional â­ NEW
- âœ… **Depositar**: Registro de aportes con categorÃ­a y miembro â­ NEW
- âœ… **Retirar**: Retiros con validaciÃ³n de balance + opciÃ³n transacciÃ³n comÃºn â­ NEW
- âœ… **Historial Completo**: Tabla con balance before/after y trazabilidad â­ NEW
- âœ… **Progress Tracking**: Barra de progreso hacia meta configurada

### ğŸ“Š Reportes y AnÃ¡lisis

- âœ… **Tendencias Mensuales**: LineChart con ingresos/gastos Ãºltimos 6 meses â­ NEW
- âœ… **DistribuciÃ³n por CategorÃ­a**: PieChart top 5 categorÃ­as mÃ¡s gastadas â­ NEW
- âœ… **ComparaciÃ³n Contribuciones**: BarChart esperado vs pagado por miembro â­ NEW
- âœ… **Ranking CategorÃ­as**: Tabla top 10 con contador de transacciones â­ NEW
- âœ… **Visualizaciones Recharts**: Interactivas, responsive y con privacy mode

### ğŸ“… GestiÃ³n de PerÃ­odos Mensuales

- âœ… **Cierre Mensual**: Lock de transacciones y ajustes con validaciÃ³n secuencial
- âœ… **Reapertura**: Unlock con auditorÃ­a y contador de reaperturas
- âœ… **Estados**: future, active, closing, closed, historical
- âœ… **Logs de Acceso**: AuditorÃ­a completa de cierres/reaperturas

### ğŸ¨ Experiencia de Usuario

- âœ… **Dark/Light Mode**: Persistencia con detecciÃ³n del sistema (next-themes)
- âœ… **Responsive Design**: Optimizado para mÃ³vil y escritorio
- âœ… **Updates Optimistas**: UI instantÃ¡nea con sincronizaciÃ³n en background
- âœ… **Notificaciones**: Toast messages con Sonner

### ğŸ› ï¸ AdministraciÃ³n

- âœ… **Panel de Admin**: Dashboard completo para system admins
- âœ… **GestiÃ³n de Miembros**: Cambiar roles, eliminar miembros
- âœ… **Wipe con ProtecciÃ³n**: Limpiar datos de testing con anti-wipe
- âœ… **Perfil Personal**: EdiciÃ³n de ingresos y preferencias

## ğŸš€ Stack TecnolÃ³gico

- **Framework**: Next.js 15 (App Router, Server Actions, React 19)
- **Lenguaje**: TypeScript estricto
- **UI**: Tailwind CSS + shadcn/ui
- **Tema**: next-themes (dark/light mode)
- **Formularios**: React Hook Form + Zod
- **Base de Datos**: PostgreSQL 15.14 nativo (NO Supabase)
- **GrÃ¡ficas**: Recharts
- **Deploy**: PM2 en servidor Linux propio (cuentas.sikwow.com)
- **CI/CD**: GitHub Actions + Release Please

---

## ğŸ—„ï¸ Base de Datos

### PostgreSQL Nativo

**ProducciÃ³n**: `cuentassik_prod` (PostgreSQL 15.14)
**Desarrollo**: `cuentassik_dev` (local)

### Setup Inicial

```bash
# 1. Instalar PostgreSQL
sudo apt install postgresql postgresql-contrib

# 2. Crear base de datos
sudo -u postgres psql << 'EOF'
CREATE DATABASE cuentassik_dev;
CREATE USER cuentassik_user WITH PASSWORD 'tu_password';
ALTER DATABASE cuentassik_dev OWNER TO cuentassik_user;
EOF

# 3. Aplicar schema base
sudo -u postgres psql -d cuentassik_dev -f database/seeds/schema_only.sql

# 4. Configurar .env.development.local
DATABASE_URL="postgresql://cuentassik_user:tu_password@localhost:5432/cuentassik_dev"
```

### Migraciones

**FilosofÃ­a**:

- Partimos de seed v0.3.0 (prod = dev sincronizadas)
- Migraciones = **solo estructura**, nunca contenido
- Seguridad: nunca borrar campos con <3 meses uso

**Workflow**:

1. `development/` â†’ WIP local (ignorado en Git)
2. `tested/` â†’ Validadas en DEV, listas para PROD (en Git)
3. `applied/` â†’ Aplicadas en PROD (en Git)
4. `applied/archive/` â†’ HistÃ³ricas obsoletas (ignorado en Git)

ğŸ“– **DocumentaciÃ³n completa**: [database/README.md](./database/README.md)

---

## ğŸ”§ GestiÃ³n del Proyecto con MCPs

Este proyecto utiliza **Model Context Protocols (MCPs)** para automatizaciÃ³n del desarrollo:

### ğŸ™ GitHub MCP

```bash
# GestiÃ³n de branches
mcp_github_github_create_branch(owner, repo, branch, from_branch)
mcp_github_github_list_branches(owner, repo)

# Push directo de archivos
mcp_github_github_push_files(owner, repo, branch, files, message)
mcp_github_github_create_or_update_file(owner, repo, path, content, message, branch, sha)

# Issues (activar con activate_github_issue_management)
# Workflows (activar con activate_github_workflow_management)
```

### ğŸŒ¿ Git MCP

```bash
# Operaciones Git sin CLI
mcp_git_git_status(path)
mcp_git_git_add(path, files)
mcp_git_git_commit(path, message)
mcp_git_git_push(path, remote, branch)
mcp_git_git_branch(path, mode, branchName)
mcp_git_git_checkout(path, branchOrPath)
```

---

## ğŸš€ Quick Start

teamId: "your-vercel-team-id"
});

````

**âš ï¸ Regla CrÃ­tica**: SIEMPRE usar MCPs en lugar de acciones manuales o CLI. Ver `.github/copilot-instructions.md` para workflows completos.

## ğŸ“‹ Requisitos Previos

- Node.js 20.x o superior
- npm
- Cuenta en Supabase (gratuita)
- (Opcional) MCPs configurados para automatizaciÃ³n completa

## ğŸ› ï¸ Setup Local

### 1. Clonar el repositorio

```bash
git clone https://github.com/Kavalieri/CuentasSiK.git
cd CuentasSiK
````

### 2. Instalar dependencias

```bash
npm install
```

### 3. Configurar PostgreSQL

```bash
# Crear base de datos
sudo -u postgres psql << 'EOF'
CREATE DATABASE cuentassik_dev;
CREATE USER cuentassik_user WITH PASSWORD 'tu_password';
ALTER DATABASE cuentassik_dev OWNER TO cuentassik_user;
GRANT ALL PRIVILEGES ON DATABASE cuentassik_dev TO cuentassik_user;
EOF

# Aplicar schema base v0.3.0
sudo -u postgres psql -d cuentassik_dev -f database/seeds/schema_only.sql

# Verificar tablas creadas
psql -U cuentassik_user -d cuentassik_dev -c "\dt"
```

ğŸ“– **GuÃ­a completa de setup**: [database/README.md](./database/README.md)

### 4. Configurar variables de entorno

Crea un archivo `.env.development.local` en la raÃ­z:

```env
NEXT_PUBLIC_SUPABASE_URL=tu_url_de_supabase
NEXT_PUBLIC_SUPABASE_ANON_KEY=tu_anon_key
```

### 5. Ejecutar en desarrollo

```bash
npm run dev
```

Abre [http://localhost:3000](http://localhost:3000) en tu navegador.

## ğŸ“ Estructura del Proyecto

```
CuentasSiK/
â”œâ”€â”€ app/                      # Next.js App Router
â”‚   â”œâ”€â”€ (marketing)/         # Landing page
â”‚   â”œâ”€â”€ login/               # AutenticaciÃ³n
â”‚   â””â”€â”€ app/                 # Ãrea privada
â”‚       â”œâ”€â”€ layout.tsx       # Layout con navegaciÃ³n
â”‚       â”œâ”€â”€ page.tsx         # Dashboard
â”‚       â”œâ”€â”€ expenses/        # GestiÃ³n de movimientos
â”‚       â”œâ”€â”€ categories/      # GestiÃ³n de categorÃ­as
â”‚       â”œâ”€â”€ contributions/   # Sistema de contribuciones
â”‚       â”œâ”€â”€ profile/         # Perfil personal
â”‚       â”œâ”€â”€ admin/           # Panel de administraciÃ³n
â”‚       â”œâ”€â”€ settings/        # ConfiguraciÃ³n del hogar
â”‚       â””â”€â”€ household/       # Legacy (deprecar)
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ ui/                  # Componentes shadcn/ui
â”‚   â””â”€â”€ shared/              # Componentes compartidos
â”‚       â”œâ”€â”€ PrivacyProvider.tsx   # Contexto de privacidad
â”‚       â”œâ”€â”€ PrivacyToggle.tsx     # Toggle Eye/EyeOff
â”‚       â””â”€â”€ PrivateAmount.tsx     # Wrapper para cantidades privadas
â”œâ”€â”€ lib/                     # Utilidades
â”‚   â”œâ”€â”€ supabaseServer.ts   # Cliente PostgreSQL server-side (query abstraction)
â”‚   â”œâ”€â”€ format.ts           # Formateo de moneda y fechas
â”‚   â”œâ”€â”€ adminCheck.ts       # VerificaciÃ³n de permisos owner
â”‚   â”œâ”€â”€ contributionTypes.ts # Tipos de cÃ¡lculo (proportional, equal, custom)
â”‚   â”œâ”€â”€ result.ts           # Pattern Result
â”‚   â”œâ”€â”€ format.ts           # Formateo de moneda y fechas
â”‚   â”œâ”€â”€ adminCheck.ts       # VerificaciÃ³n de permisos owner
â”‚   â”œâ”€â”€ contributionTypes.ts # Tipos de cÃ¡lculo
â”‚   â”œâ”€â”€ result.ts           # Pattern Result
â”‚   â””â”€â”€ utils.ts            # Utilidades generales
â”œâ”€â”€ database/                # PostgreSQL nativo
â”‚   â”œâ”€â”€ seeds/
â”‚   â”‚   â””â”€â”€ schema_only.sql # Schema base v0.3.0
â”‚   â”œâ”€â”€ schemas/
â”‚   â”‚   â””â”€â”€ migrations_control.sql # Tabla de control
â”‚   â”œâ”€â”€ migrations/
â”‚   â”‚   â”œâ”€â”€ development/    # WIP local (ignorado)
â”‚   â”‚   â”œâ”€â”€ tested/         # Validadas para PROD (en repo)
â”‚   â”‚   â””â”€â”€ applied/        # Aplicadas en PROD (en repo)
â”‚   â”‚       â””â”€â”€ archive/    # HistÃ³ricas obsoletas (ignorado)
â”‚   â”œâ”€â”€ AGENTS.md           # Instrucciones para IA
â”‚   â””â”€â”€ README.md           # Setup y workflows
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ DARK_MODE.md
â”‚   â”œâ”€â”€ PRIVACY_MODE.md
â”‚   â””â”€â”€ README.md
â””â”€â”€ types/
    â””â”€â”€ database.ts         # Tipos TypeScript
```

## ğŸ¯ Comandos Disponibles

```bash
npm run dev          # Servidor de desarrollo
npm run build        # Build de producciÃ³n
npm run start        # Servidor de producciÃ³n
npm run lint         # Ejecutar ESLint
npm run typecheck    # Verificar tipos TypeScript
npm test             # Ejecutar tests
npm run test:watch   # Tests en modo watch
```

## ğŸ” AutenticaciÃ³n

La aplicaciÃ³n usa **magic links** de Supabase. Los usuarios reciben un enlace por email para iniciar sesiÃ³n sin contraseÃ±a.

## ğŸ—ï¸ Arquitectura

### Modelo de Datos

#### Tablas Core (12 tablas principales)

1. **households**: Hogar compartido (multi-hogar por usuario)
2. **household_members**: RelaciÃ³n many-to-many usuarios-hogares con roles (owner/member)
3. **categories**: CategorÃ­as personalizadas por hogar (expense/income)
4. **transactions**: Movimientos (gastos/ingresos) con descripciÃ³n y categorÃ­a
5. **transaction_history**: AuditorÃ­a de cambios en movimientos â­ NEW (Oct 2025)

#### Sistema de Contribuciones (4 tablas) â­

6. **member_incomes**: Historial de ingresos mensuales por miembro
7. **household_settings**: Meta de contribuciÃ³n mensual + tipo de cÃ¡lculo
8. **contributions**: Contribuciones calculadas y rastreadas por miembro/mes
9. **contribution_adjustments**: Ajustes con workflow de aprobaciÃ³n (pending/approved/rejected)

#### Sistema de MÃºltiples Hogares (2 tablas) â­ NEW

10. **user_settings**: ConfiguraciÃ³n del usuario (active_household_id, preferences)
11. **invitations**: Sistema de invitaciones con RLS pÃºblico para acceso sin login

#### Sistema de Privacidad (1 tabla) â­ NEW

12. **PrivacyProvider**: Contexto React con estado hideAmounts persistido en localStorage

### Sistema de Historial de Transacciones â­ NEW (Oct 2025)

**CaracterÃ­sticas**:

- **Trigger AutomÃ¡tico**: `save_transaction_history()` se ejecuta AFTER UPDATE en `transactions`
- **Campos Rastreados**: description, occurred_at, category_id, amount
- **Metadatos**: changed_by (profile_id), changed_at, change_reason, household_id
- **RLS**: Solo miembros del household pueden ver su historial
- **Cascade Delete**: Si se borra transaction, su historial tambiÃ©n
- **UI**: EditMovementDialog con validaciones y toast notifications

**Uso**:

```typescript
// Editar movimiento (trigger guarda historial automÃ¡ticamente)
await updateMovement(formData);

// Obtener historial de un movimiento
const history = await getMovementHistory(movementId);
// Retorna: old/new values + changed_by profile + old/new categories
```

### Row Level Security (RLS)

**Todas las tablas** tienen RLS habilitado desde el dÃ­a 1. Las polÃ­ticas verifican que `auth.uid()` pertenezca al `household_id` del recurso consultado mediante funciones helper:

- `get_profile_id_from_auth()`: Obtiene profile_id del usuario autenticado
- `getUserHouseholdId()`: Obtiene el household_id activo del usuario
- VerificaciÃ³n de membresÃ­a en `household_members`

### Patrones de AutenticaciÃ³n

- **Auth**: Magic link por email (sin contraseÃ±a) vÃ­a Supabase Auth
- **SesiÃ³n**: Validar en Server Components con `lib/supabaseServer.ts`
- **Server Actions**: ValidaciÃ³n con Zod schemas antes de mutaciones
- **Result Pattern**: `ok()` y `fail()` para manejo de errores consistente
- **user_settings**: ConfiguraciÃ³n del usuario (active_household_id, preferences)
- **invitations**: Sistema de invitaciones con constraint parcial y RLS pÃºblico

#### AdministraciÃ³n

- **system_admins**: Super administradores con acceso completo
- **wipe_protection**: ProtecciÃ³n contra wipes accidentales

### Seguridad

- **Row Level Security (RLS)** habilitado en todas las tablas
- PolÃ­ticas que verifican `auth.uid()` pertenece al household
- **PolÃ­tica pÃºblica de invitaciones**: Permite acceso sin login (token de 64 caracteres)

### MÃºltiples Hogares

Los usuarios pueden:

- Crear ilimitados hogares (como owner)
- Aceptar invitaciones a otros hogares (como member)
- Cambiar entre hogares usando el selector en el header
- Ver solo datos del hogar activo en cada momento

**Funcionalidades**:

- **Selector de Hogares**: Dropdown con iconos (ğŸ‘‘ owner, ğŸ‘¥ member) que aparece con 2+ hogares
- **Auto-activaciÃ³n**: Nuevos hogares (creados o aceptados) se activan automÃ¡ticamente
- **Persistencia**: El hogar activo se guarda en `user_settings.active_household_id`
- **Cambio de Contexto**: Al cambiar de hogar, toda la UI se actualiza (dashboard, gastos, contribuciones, etc.)
- ValidaciÃ³n con Zod en todas las Server Actions
- **Sistema de roles**: `owner` (admin completo) y `member` (usuario normal)
- ProtecciÃ³n de rutas admin con `lib/adminCheck.ts`

### Patrones de CÃ³digo

- **Server Actions** para todas las mutaciones
- Pattern **Result** para manejo de errores: `{ ok: true, data? } | { ok: false, message, fieldErrors? }`
- Imports absolutos con alias `@/`
- Named exports por defecto
- `type` preferido sobre `interface`

## ğŸš€ Despliegue en Vercel

### Auto-deploy Configurado âœ…

El proyecto estÃ¡ configurado con **auto-deploy desde GitHub**:

- âœ… **Push a `main`** â†’ Deploy automÃ¡tico a producciÃ³n
- âœ… **Pull Requests** â†’ Deploy preview con URL Ãºnica
- âœ… **URL de producciÃ³n**: https://cuentas-sik.vercel.app

### Setup Manual

Si necesitas desplegar manualmente:

1. Instala Vercel CLI: `npm i -g vercel`
2. Login: `vercel login`
3. Deploy: `vercel --prod`

### ConfiguraciÃ³n de Variables de Entorno

En el dashboard de Vercel (Settings â†’ Environment Variables):

```env
NEXT_PUBLIC_SUPABASE_URL=https://fizxvvtakvmmeflmbwud.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=tu_anon_key
```

**Importante**: DespuÃ©s de configurar, actualiza las **Redirect URLs** en Supabase:

- Settings â†’ Authentication â†’ URL Configuration
- AÃ±ade: `https://cuentas-sik.vercel.app/auth/callback`

Ver [docs/VERCEL_DEPLOY.md](docs/VERCEL_DEPLOY.md) para mÃ¡s detalles.

## ğŸ“ Convenciones de Commits

Usa **Conventional Commits**:

- `feat:` nueva funcionalidad (bump minor)
- `fix:` correcciÃ³n de bug (bump patch)
- `chore:`, `docs:`, `refactor:`, `test:` sin bump
- `feat!:` breaking change (bump major)

Ejemplo:

```bash
git commit -m "feat: add CSV export for transactions"
```

## ğŸ”„ Workflow de Desarrollo

### Versionado y Releases

**Sistema**: Release Please con pre-releases alpha
**VersiÃ³n actual**: `0.0.0` â†’ Primera release serÃ¡ `0.0.1-alpha.0`

**Proceso automÃ¡tico**:

1. Haces commits con Conventional Commits
2. Push a `main` â†’ Auto-deploy en Vercel
3. Release Please crea/actualiza PR con CHANGELOG
4. Al mergear el PR â†’ Se crea tag + GitHub Release automÃ¡ticamente

Ver [docs/VERSIONING_AND_RELEASES.md](docs/VERSIONING_AND_RELEASES.md)

### Proceso de Desarrollo

1. Haz cambios en tu rama local
2. Commits siguiendo Conventional Commits:
   ```bash
   git commit -m "feat: add new feature"
   git commit -m "fix: resolve bug in contributions"
   ```
3. Push a `main`:
   ```bash
   git push origin main
   ```
4. **Auto-deploy** se activa automÃ¡ticamente en Vercel
5. Release Please detecta commits y:
   - Crea/actualiza PR con changelog
   - Al mergear â†’ Crea tag + release en GitHub

### Supabase Migrations

Usando Supabase CLI para gestionar cambios en la base de datos:

```bash
# Crear nueva migraciÃ³n
npx supabase migration new nombre_descriptivo

# Aplicar migraciones a producciÃ³n
npx supabase db push

# Regenerar tipos TypeScript
npm run types:supabase
```

Ver [docs/SUPABASE_CLI.md](docs/SUPABASE_CLI.md) para mÃ¡s detalles.

## ğŸ§ª Testing

- **Unit tests** con Vitest para utilidades (`lib/`)
- **React Testing Library** para componentes crÃ­ticos
- **NO testeamos** integraciones Supabase (confiar en RLS)
- Coverage objetivo: 60-70% en utilities y formularios

## ğŸ“š DocumentaciÃ³n

### GuÃ­as Principales

- [Instrucciones para AI Agents](.github/copilot-instructions.md) - GuÃ­a completa del proyecto
- [Sistema de Contribuciones](docs/CONTRIBUTIONS_SYSTEM.md) - CÃ³mo funciona el sistema proporcional
- [Sistema de MÃºltiples Hogares](docs/MULTI_HOUSEHOLD_IMPLEMENTATION_COMPLETE.md) â­ - GestiÃ³n multi-hogar
- [Plan de RefactorizaciÃ³n](docs/CONTRIBUTIONS_REFACTOR_PLAN.md) â­ - Mejoras implementadas
- [Privacy Mode](docs/PRIVACY_MODE.md) â­ NEW - Sistema de ocultaciÃ³n de cantidades
- [Procedimiento de Testing](docs/TEST_PROCEDURE.md) â­ NEW - Testing completo desde cero
- [Resumen de SesiÃ³n](docs/SESSION_SUMMARY_2025-10-04.md) â­ NEW - Cambios recientes
- [GestiÃ³n de Usuarios](docs/USER_MANAGEMENT_IMPLEMENTATION.md) - Roles y permisos
- [Sistema Anti-Wipe](docs/WIPE_PROTECTION_SYSTEM.md) â­ - ProtecciÃ³n de datos
- [Modo Oscuro](docs/DARK_MODE.md) - ImplementaciÃ³n dark/light mode
- [Deploy en Vercel](docs/VERCEL_DEPLOY.md) - GuÃ­a de despliegue
- [Supabase CLI](docs/SUPABASE_CLI.md) - Workflow de migraciones
- [Versionado](docs/VERSIONING_AND_RELEASES.md) - Sistema de pre-releases alpha

### Referencias

- [EspecificaciÃ³n Completa](prompt_inicial_del_agente_app_gastos_pareja_next_instructions.md)
- [DocumentaciÃ³n de Supabase](https://supabase.com/docs)
- [DocumentaciÃ³n de Next.js](https://nextjs.org/docs)
- [shadcn/ui](https://ui.shadcn.com)

## ğŸ›£ï¸ Roadmap

### âœ… Completado (v0.0.1-alpha.0)

- [x] Setup inicial del proyecto
- [x] AutenticaciÃ³n con magic links
- [x] Sistema de households con RLS
- [x] **Sistema de mÃºltiples hogares** â­ NEW
  - [x] Usuarios pueden crear/unirse a ilimitados hogares
  - [x] Selector de hogares con iconos (ğŸ‘‘ owner, ğŸ‘¥ member)
  - [x] Auto-activaciÃ³n de hogares nuevos/aceptados
  - [x] Cambio de contexto en tiempo real
- [x] **Sistema de invitaciones mejorado** â­ NEW
  - [x] Invitaciones pÃºblicas (funcionan sin login)
  - [x] Fix constraint (permite recrear despuÃ©s de cancelar)
  - [x] Cookie cleanup automÃ¡tico
- [x] CRUD de categorÃ­as y movimientos
- [x] Dashboard con resumen mensual
- [x] Modo oscuro con persistencia
- [x] Panel de administraciÃ³n completo
- [x] Sistema de contribuciones proporcionales
- [x] **Tipos de cÃ¡lculo mÃºltiples** (proporcional, igual, custom)
- [x] **Sistema de pre-pagos** â­
- [x] **Pagos flexibles** (parcial, completo, sobrepago) â­
- [x] Supabase CLI workflow
- [x] Auto-deploy en Vercel
- [x] Build de producciÃ³n (23 pÃ¡ginas)

### ğŸš§ En Progreso

- [ ] Testing manual de mÃºltiples hogares en producciÃ³n
- [ ] Verificar flujo de invitaciones sin login

### ğŸ“‹ PrÃ³ximas Features (v1.1.0)

- [ ] Sistema de notificaciones push
- [ ] GrÃ¡ficos avanzados con anÃ¡lisis histÃ³rico
- [ ] Export/Import CSV/Excel
- [ ] Import desde Excel existente (`Cuentas Casa SiK.xlsx`)
- [ ] History tab visual de contribuciones
- [ ] Filtros avanzados en movimientos (bÃºsqueda, rango de fechas)
- [ ] GestiÃ³n avanzada de mÃºltiples hogares (favoritos, recientes)

### ğŸ”® Futuro (v2.0.0+)

- [ ] IntegraciÃ³n con Google Sheets
- [ ] PWA (Progressive Web App) con soporte offline
- [ ] Notificaciones push en dispositivos
- [ ] Dashboard de analytics con tendencias
- [ ] API REST para integraciones externas
- [ ] App mÃ³vil nativa (React Native)

---

## ğŸ¤ Contribuir

Â¡Las contribuciones son bienvenidas! Este es un proyecto open source y agradecemos cualquier ayuda.

### ğŸ“ CÃ³mo Contribuir

1. **Fork** el proyecto
2. **Crea una rama** para tu feature (`git checkout -b feat/amazing-feature`)
3. **Commit** tus cambios (`git commit -m 'feat: add amazing feature'`)
4. **Push** a la rama (`git push origin feat/amazing-feature`)
5. **Abre un Pull Request**

### ğŸ¯ Conventional Commits

Usamos [Conventional Commits](https://www.conventionalcommits.org/) para mensajes claros:

```bash
feat: nueva funcionalidad
fix: correcciÃ³n de bug
docs: cambios en documentaciÃ³n
chore: tareas de mantenimiento
refactor: refactorizaciÃ³n de cÃ³digo
test: aÃ±adir o mejorar tests
```

### ğŸ› Reportar Bugs

Si encuentras un bug, por favor [abre un issue](https://github.com/Kavalieri/CuentasSiK/issues/new) con:

- DescripciÃ³n clara del problema
- Pasos para reproducirlo
- Comportamiento esperado vs actual
- Screenshots (si aplica)
- Entorno (navegador, OS)

### ğŸ’¡ Solicitar Features

Â¿Tienes una idea? [Abre un issue](https://github.com/Kavalieri/CuentasSiK/issues/new) con la etiqueta `enhancement`:

- DescripciÃ³n detallada de la feature
- Casos de uso
- Mockups o wireframes (opcional)

---

## ğŸ“„ Licencia

Este proyecto estÃ¡ bajo la Licencia MIT. Ver el archivo [LICENSE](./LICENSE) para mÃ¡s detalles.

```
MIT License

Copyright (c) 2025 CuentasSiK Contributors

Se concede permiso, de forma gratuita, a cualquier persona que obtenga una copia
de este software y archivos de documentaciÃ³n asociados (el "Software"), para usar
el Software sin restricciÃ³n, incluyendo sin limitaciÃ³n los derechos de uso, copia,
modificaciÃ³n, fusiÃ³n, publicaciÃ³n, distribuciÃ³n, sublicencia y/o venta de copias
del Software.
```

---

## ğŸ‘¥ Autores y Reconocimientos

### ğŸ’» Mantenedores

- **[Kavalieri](https://github.com/Kavalieri)** - _Creador y desarrollador principal_

### ğŸ™ Agradecimientos

- **[Supabase](https://supabase.com)** - Por el increÃ­ble backend-as-a-service
- **[Vercel](https://vercel.com)** - Por el hosting y deployment automÃ¡tico
- **[shadcn/ui](https://ui.shadcn.com/)** - Por los componentes UI de calidad
- **[Next.js Team](https://nextjs.org/)** - Por el framework mÃ¡s potente de React
- Comunidad de **GitHub Copilot** por las herramientas de AI y MCPs

### ğŸŒŸ InspiraciÃ³n

Este proyecto naciÃ³ de la necesidad real de gestionar gastos compartidos de forma justa y transparente en pareja. Inspirado en el principio de que cada uno debe aportar segÃºn sus posibilidades, manteniendo la equidad y el respeto mutuo.

---

## ğŸ“ Contacto y Soporte

- **Issues**: [GitHub Issues](https://github.com/Kavalieri/CuentasSiK/issues)
- **Discussions**: [GitHub Discussions](https://github.com/Kavalieri/CuentasSiK/discussions)
- **Demo en Vivo**: [cuentas-sik.vercel.app](https://cuentas-sik.vercel.app)

---

## ğŸ“Š Estado del Proyecto

![GitHub last commit](https://img.shields.io/github/last-commit/Kavalieri/CuentasSiK)
![GitHub issues](https://img.shields.io/github/issues/Kavalieri/CuentasSiK)
![GitHub pull requests](https://img.shields.io/github/issues-pr/Kavalieri/CuentasSiK)

**VersiÃ³n actual**: v1.0.0
**Estado**: âœ… Production Ready
**Ãšltima actualizaciÃ³n**: Octubre 2025

---

<div align="center">

**Hecho con â¤ï¸ para mejorar la transparencia financiera en pareja**

[â¬† Volver arriba](#-cuentassik)

</div>

## ğŸ‘¥ Contribuir

1. Fork el repositorio
2. Crea una rama: `git checkout -b feat/amazing-feature`
3. Commit: `git commit -m 'feat: add amazing feature'`
4. Push: `git push origin feat/amazing-feature`
5. Abre un Pull Request

## ğŸ“§ Contacto

Para preguntas o sugerencias, abre un issue en GitHub.

---

Hecho con â¤ï¸ para gestionar gastos en pareja
