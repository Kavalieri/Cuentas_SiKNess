{
  "version": "2.0.0",
  "tasks": [
    // ========================================
    // üéÆ PM2 - GESTI√ìN DE PROCESOS (LIMPIA)
    // ========================================
    {
      "label": "üü¢ DEV: Iniciar (con archivado de logs)",
      "type": "shell",
      "command": "./scripts/pm2-dev-start.sh",
      "group": {
        "kind": "build",
        "isDefault": false
      },
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": false,
        "panel": "shared",
        "showReuseMessage": false
      },
      "problemMatcher": []
    },
    {
      "label": "üî¥ DEV: Detener",
      "type": "shell",
      "command": "./scripts/pm2-dev-stop.sh",
      "group": "build",
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": false,
        "panel": "shared",
        "showReuseMessage": false
      },
      "problemMatcher": []
    },
    {
      "label": "üîÑ DEV: Reiniciar (Stop + Start con logs limpios)",
      "type": "shell",
      "command": "bash",
      "args": ["-c", "./scripts/pm2-dev-stop.sh && sleep 1 && ./scripts/pm2-dev-start.sh"],
      "group": {
        "kind": "build",
        "isDefault": true
      },
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": false,
        "panel": "shared",
        "showReuseMessage": false
      },
      "problemMatcher": []
    },
    {
      "label": "üü¢ PROD: Iniciar (con archivado de logs)",
      "type": "shell",
      "command": "./scripts/pm2-prod-start.sh",
      "group": "build",
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": false,
        "panel": "shared",
        "showReuseMessage": false
      },
      "problemMatcher": []
    },
    {
      "label": "üî¥ PROD: Detener",
      "type": "shell",
      "command": "./scripts/pm2-prod-stop.sh",
      "group": "build",
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": false,
        "panel": "shared",
        "showReuseMessage": false
      },
      "problemMatcher": []
    },
    {
      "label": "üîÑ PROD: Reiniciar (Stop + Start con logs limpios)",
      "type": "shell",
      "command": "bash",
      "args": ["-c", "./scripts/pm2-prod-stop.sh && sleep 2 && ./scripts/pm2-prod-start.sh"],
      "group": "build",
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": false,
        "panel": "shared",
        "showReuseMessage": false
      },
      "problemMatcher": []
    },
    {
      "label": "üèóÔ∏è PROD: Build + Deploy + Reiniciar",
      "type": "shell",
      "command": "${workspaceFolder}/scripts/build-and-deploy.sh",
      "group": "build",
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": true,
        "panel": "dedicated",
        "showReuseMessage": false,
        "clear": true
      },
      "problemMatcher": []
    },
    // ========================================
    // üìä PM2 - MONITOREO Y LOGS
    // ========================================
    {
      "label": "üìä Estado PM2 General",
      "type": "shell",
      "command": "./scripts/pm2-status.sh",
      "group": "build",
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": false,
        "panel": "shared",
        "showReuseMessage": false
      },
      "problemMatcher": []
    },
    {
      "label": "üìã DEV: Ver Logs (√∫ltimas 50 l√≠neas)",
      "type": "shell",
      "command": "pm2",
      "args": ["logs", "cuentassik-dev", "--lines", "50", "--nostream"],
      "group": "build",
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": false,
        "panel": "shared",
        "showReuseMessage": false
      },
      "problemMatcher": []
    },
    {
      "label": "üöÄ DEV: Consola en Tiempo Real",
      "type": "shell",
      "command": "pm2",
      "args": ["logs", "cuentassik-dev", "--timestamp"],
      "isBackground": true,
      "group": "build",
      "presentation": {
        "echo": false,
        "reveal": "always",
        "focus": true,
        "panel": "dedicated",
        "showReuseMessage": false,
        "clear": true
      },
      "problemMatcher": []
    },
    {
      "label": "üìã PROD: Ver Logs (√∫ltimas 50 l√≠neas)",
      "type": "shell",
      "command": "pm2",
      "args": ["logs", "cuentassik-prod", "--lines", "50", "--nostream"],
      "group": "build",
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": false,
        "panel": "shared",
        "showReuseMessage": false
      },
      "problemMatcher": []
    },
    {
      "label": "üöÄ PROD: Consola en Tiempo Real",
      "type": "shell",
      "command": "pm2",
      "args": ["logs", "cuentassik-prod", "--timestamp"],
      "isBackground": true,
      "group": "build",
      "presentation": {
        "echo": false,
        "reveal": "always",
        "focus": true,
        "panel": "dedicated",
        "showReuseMessage": false,
        "clear": true
      },
      "problemMatcher": []
    },
    // ========================================
    // üßπ PM2 - MANTENIMIENTO DE LOGS
    // ========================================
    {
      "label": "üßπ Limpiar Logs PM2 (7 d√≠as)",
      "type": "shell",
      "command": "./scripts/pm2-clean-logs.sh",
      "args": ["7"],
      "group": "build",
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": false,
        "panel": "shared",
        "showReuseMessage": false
      },
      "problemMatcher": []
    },
    {
      "label": "üßπ Limpiar Logs PM2 (30 d√≠as)",
      "type": "shell",
      "command": "./scripts/pm2-clean-logs.sh",
      "args": ["30"],
      "group": "build",
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": false,
        "panel": "shared",
        "showReuseMessage": false
      },
      "problemMatcher": []
    },
    // ========================================
    // üèóÔ∏è BUILD Y HERRAMIENTAS
    // ========================================
    {
      "label": "üèóÔ∏è Build Solo (sin deploy)",
      "type": "shell",
      "command": "bash",
      "args": ["-c", "echo 'üßπ Cleaning previous build...' && rm -rf .next && echo 'üèóÔ∏è Building for production...' && npm run build"],
      "group": {
        "kind": "build",
        "isDefault": false
      },
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": true,
        "panel": "dedicated",
        "showReuseMessage": false,
        "clear": true
      },
      "problemMatcher": []
    },
    {
      "label": "üîÑ Aplicar Migraciones a DEV",
      "type": "shell",
      "command": "${workspaceFolder}/scripts/apply_migrations_dev.sh",
      "group": "build"
    },
    {
      "label": "‚¨ÜÔ∏è Promover Migraci√≥n (dev ‚Üí tested)",
      "type": "shell",
      "command": "${workspaceFolder}/scripts/promote_migration.sh"
    },
    {
      "label": "üìä Ver Estado Migraciones",
      "type": "shell",
      "command": "echo 'üìä DEVELOPMENT:' && ls -1 ${workspaceFolder}/database/migrations/development/*.sql 2>/dev/null | wc -l && echo '‚úÖ TESTED:' && ls -1 ${workspaceFolder}/database/migrations/tested/*.sql 2>/dev/null | wc -l && echo 'üì¶ APPLIED:' && ls -1 ${workspaceFolder}/database/migrations/applied/*.sql 2>/dev/null | wc -l && echo 'üóÑÔ∏è ARCHIVE:' && ls -1 ${workspaceFolder}/database/migrations/applied/archive/*.sql 2>/dev/null | wc -l"
    },
    // ========================================
    // üóÑÔ∏è DATABASE - SINCRONIZACI√ìN
    // ========================================
    {
      "label": "üîÑ Sincronizar DEV ‚Üí PROD (Database)",
      "type": "shell",
      "command": "./scripts/sync_dev_to_prod.sh",
      "group": "build",
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": true,
        "panel": "dedicated",
        "showReuseMessage": false,
        "clear": true
      },
      "problemMatcher": []
    },
    {
      "label": "üìä Verificar Estado Bases de Datos",
      "type": "shell",
      "command": "bash",
      "args": [
        "-c",
        "echo 'üîµ DEV Database:' && psql -h 127.0.0.1 -U cuentassik_user -d cuentassik_dev -c 'SELECT COUNT(*) as total_transactions FROM transactions; SELECT COUNT(*) as total_profiles FROM profiles; SELECT COUNT(*) as total_households FROM households;' && echo '' && echo 'üî¥ PROD Database:' && psql -h 127.0.0.1 -U cuentassik_user -d cuentassik_prod -c 'SELECT COUNT(*) as total_transactions FROM transactions; SELECT COUNT(*) as total_profiles FROM profiles; SELECT COUNT(*) as total_households FROM households;'"
      ],
      "group": "build",
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": false,
        "panel": "shared",
        "showReuseMessage": false
      },
      "problemMatcher": []
    }
  ]
}
