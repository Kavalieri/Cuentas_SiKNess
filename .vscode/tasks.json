{
  "version": "2.0.0",
  "tasks": [
    // ========================================
    // ðŸŽ® PM2 - GESTIÃ“N DE PROCESOS (LIMPIA)
    // ========================================
    {
      "label": "ðŸŸ¢ DEV: Iniciar (con archivado de logs)",
      "type": "shell",
      "command": "./scripts/pm2-dev-start.sh",
      "group": {
        "kind": "build",
        "isDefault": false
      },
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": false,
        "panel": "shared",
        "showReuseMessage": false
      },
      "problemMatcher": []
    },
    {
      "label": "ðŸ”´ DEV: Detener",
      "type": "shell",
      "command": "./scripts/pm2-dev-stop.sh",
      "group": "build",
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": false,
        "panel": "shared",
        "showReuseMessage": false
      },
      "problemMatcher": []
    },
    {
      "label": "ðŸ”„ DEV: Reiniciar (Stop + Start con logs limpios)",
      "type": "shell",
      "command": "bash",
      "args": ["-c", "./scripts/pm2-dev-stop.sh && sleep 1 && ./scripts/pm2-dev-start.sh"],
      "group": {
        "kind": "build",
        "isDefault": true
      },
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": false,
        "panel": "shared",
        "showReuseMessage": false
      },
      "problemMatcher": []
    },
    {
      "label": "ðŸŸ¢ PROD: Iniciar (con archivado de logs)",
      "type": "shell",
      "command": "./scripts/pm2-prod-start.sh",
      "group": "build",
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": false,
        "panel": "shared",
        "showReuseMessage": false
      },
      "problemMatcher": []
    },
    {
      "label": "ðŸ”´ PROD: Detener",
      "type": "shell",
      "command": "./scripts/pm2-prod-stop.sh",
      "group": "build",
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": false,
        "panel": "shared",
        "showReuseMessage": false
      },
      "problemMatcher": []
    },
    {
      "label": "ðŸ”„ PROD: Reiniciar (Stop + Start con logs limpios)",
      "type": "shell",
      "command": "bash",
      "args": ["-c", "./scripts/pm2-prod-stop.sh && sleep 2 && ./scripts/pm2-prod-start.sh"],
      "group": "build",
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": false,
        "panel": "shared",
        "showReuseMessage": false
      },
      "problemMatcher": []
    },
    {
      "label": "ðŸ—ï¸ PROD: Build + Deploy + Reiniciar",
      "type": "shell",
      "command": "bash",
      "args": [
        "-c",
        "echo 'ðŸ—ï¸ Building for production...' && npm run build && echo 'ðŸ”„ Restarting production...' && ./scripts/pm2-prod-stop.sh && sleep 2 && ./scripts/pm2-prod-start.sh && echo 'âœ… Production deployed!'"
      ],
      "group": "build",
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": false,
        "panel": "shared",
        "showReuseMessage": false
      },
      "problemMatcher": []
    },
    // ========================================
    // ðŸ“Š PM2 - MONITOREO Y LOGS
    // ========================================
    {
      "label": "ðŸ“Š Estado PM2 General",
      "type": "shell",
      "command": "./scripts/pm2-status.sh",
      "group": "build",
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": false,
        "panel": "shared",
        "showReuseMessage": false
      },
      "problemMatcher": []
    },
    {
      "label": "ðŸ“‹ DEV: Ver Logs (Ãºltimas 50 lÃ­neas)",
      "type": "shell",
      "command": "pm2",
      "args": ["logs", "cuentassik-dev", "--lines", "50", "--nostream"],
      "group": "build",
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": false,
        "panel": "shared",
        "showReuseMessage": false
      },
      "problemMatcher": []
    },
    {
      "label": "ï¿½ DEV: Consola en Tiempo Real",
      "type": "shell",
      "command": "pm2",
      "args": ["logs", "cuentassik-dev", "--timestamp"],
      "isBackground": true,
      "group": "build",
      "presentation": {
        "echo": false,
        "reveal": "always",
        "focus": true,
        "panel": "dedicated",
        "showReuseMessage": false,
        "clear": true
      },
      "problemMatcher": []
    },
    {
      "label": "ðŸ“‹ PROD: Ver Logs (Ãºltimas 50 lÃ­neas)",
      "type": "shell",
      "command": "pm2",
      "args": ["logs", "cuentassik-prod", "--lines", "50", "--nostream"],
      "group": "build",
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": false,
        "panel": "shared",
        "showReuseMessage": false
      },
      "problemMatcher": []
    },
    {
      "label": "ï¿½ PROD: Consola en Tiempo Real",
      "type": "shell",
      "command": "pm2",
      "args": ["logs", "cuentassik-prod", "--timestamp"],
      "isBackground": true,
      "group": "build",
      "presentation": {
        "echo": false,
        "reveal": "always",
        "focus": true,
        "panel": "dedicated",
        "showReuseMessage": false,
        "clear": true
      },
      "problemMatcher": []
    },
    // ========================================
    // ðŸ§¹ PM2 - MANTENIMIENTO DE LOGS
    // ========================================
    {
      "label": "ðŸ§¹ Limpiar Logs PM2 (7 dÃ­as)",
      "type": "shell",
      "command": "./scripts/pm2-clean-logs.sh",
      "args": ["7"],
      "group": "build",
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": false,
        "panel": "shared",
        "showReuseMessage": false
      },
      "problemMatcher": []
    },
    {
      "label": "ðŸ§¹ Limpiar Logs PM2 (30 dÃ­as)",
      "type": "shell",
      "command": "./scripts/pm2-clean-logs.sh",
      "args": ["30"],
      "group": "build",
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": false,
        "panel": "shared",
        "showReuseMessage": false
      },
      "problemMatcher": []
    },
    // ========================================
    // ðŸ—ï¸ BUILD Y HERRAMIENTAS
    // ========================================
    {
      "label": "ðŸ—ï¸ Build Solo (sin deploy)",
      "type": "shell",
      "command": "npm",
      "args": ["run", "build"],
      "group": {
        "kind": "build",
        "isDefault": false
      },
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": false,
        "panel": "shared",
        "showReuseMessage": false
      },
      "problemMatcher": []
    },
    {
      "label": "ðŸš€ Abrir Testing Dual-Flow",
      "type": "shell",
      "command": "bash",
      "args": [
        "-c",
        "echo 'ðŸš€ Testing Dual-Flow disponible en:' && echo '   http://localhost:3001/dual-flow/testing' && echo '' && echo 'ðŸ“Š Estado actual:' && pm2 list | grep cuentassik-dev || echo 'Proceso dev no estÃ¡ ejecutÃ¡ndose'"
      ],
      "group": "test",
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": false,
        "panel": "shared",
        "showReuseMessage": false
      },
      "problemMatcher": []
    },

    {
      "label": "ðŸ“¥ Sincronizar PROD â†’ DEV",
      "type": "shell",
      "command": "${workspaceFolder}/scripts/sync_prod_to_dev.sh"
    },
    {
      "label": "âž• Crear Nueva MigraciÃ³n",
      "type": "shell",
      "command": "mkdir -p ${workspaceFolder}/database/migrations/development && cd ${workspaceFolder}/database/migrations/development && FILENAME=$(date +%Y%m%d_%H%M%S)_nueva_migracion.sql && echo '-- MigraciÃ³n: ' $FILENAME > $FILENAME && echo '-- DescripciÃ³n: [DESCRIBE QUÃ‰ HACE ESTA MIGRACIÃ“N]' >> $FILENAME && echo '' >> $FILENAME && echo '-- Tu SQL aquÃ­:' >> $FILENAME && echo '' >> $FILENAME && echo 'âœ… MigraciÃ³n creada:' $FILENAME"
    },
    {
      "label": "ðŸ”„ Aplicar Migraciones a DEV",
      "type": "shell",
      "command": "${workspaceFolder}/scripts/apply_migrations_dev.sh",
      "group": "build"
    },
    {
      "label": "â¬†ï¸ Promover MigraciÃ³n (dev â†’ tested)",
      "type": "shell",
      "command": "${workspaceFolder}/scripts/promote_migration.sh"
    },
    {
      "label": "ðŸ“Š Ver Estado Migraciones",
      "type": "shell",
      "command": "echo 'ðŸ“Š DEVELOPMENT:' && ls -1 ${workspaceFolder}/database/migrations/development/*.sql 2>/dev/null | wc -l && echo 'âœ… TESTED:' && ls -1 ${workspaceFolder}/database/migrations/tested/*.sql 2>/dev/null | wc -l && echo 'ðŸ“¦ APPLIED:' && ls -1 ${workspaceFolder}/database/migrations/applied/*.sql 2>/dev/null | wc -l && echo 'ðŸ—„ï¸ ARCHIVE:' && ls -1 ${workspaceFolder}/database/migrations/applied/archive/*.sql 2>/dev/null | wc -l"
    }
  ]
}
