                                                                                                                pg_get_functiondef                                                                                                                
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 CREATE OR REPLACE FUNCTION public.create_default_household_categories()                                                                                                                                                                         +
  RETURNS trigger                                                                                                                                                                                                                                +
  LANGUAGE plpgsql                                                                                                                                                                                                                               +
 AS $function$                                                                                                                                                                                                                                   +
 DECLARE                                                                                                                                                                                                                                         +
   v_parent_ingresos_laborales UUID;                                                                                                                                                                                                             +
   v_parent_otros_ingresos UUID;                                                                                                                                                                                                                 +
   v_parent_hogar UUID;                                                                                                                                                                                                                          +
   v_parent_suministros UUID;                                                                                                                                                                                                                    +
   v_parent_alimentaci_n UUID;                                                                                                                                                                                                                   +
   v_parent_transporte UUID;                                                                                                                                                                                                                     +
   v_parent_personal UUID;                                                                                                                                                                                                                       +
   v_parent_estilo_de_vida UUID;                                                                                                                                                                                                                 +
   v_parent_finanzas UUID;                                                                                                                                                                                                                       +
   v_cat_ingresos_laborales_n_mina UUID;                                                                                                                                                                                                         +
   v_cat_ingresos_laborales_freelance UUID;                                                                                                                                                                                                      +
   v_cat_ingresos_laborales_bonus UUID;                                                                                                                                                                                                          +
   v_cat_otros_ingresos_inversiones UUID;                                                                                                                                                                                                        +
   v_cat_otros_ingresos_ventas UUID;                                                                                                                                                                                                             +
   v_cat_otros_ingresos_devoluciones UUID;                                                                                                                                                                                                       +
   v_cat_otros_ingresos_aportaci_n_cuenta_conjunta UUID;                                                                                                                                                                                         +
   v_cat_otros_ingresos_pago_pr_stamo UUID;                                                                                                                                                                                                      +
   v_cat_otros_ingresos_varios UUID;                                                                                                                                                                                                             +
   v_cat_hogar_vivienda UUID;                                                                                                                                                                                                                    +
   v_cat_hogar_menaje UUID;                                                                                                                                                                                                                      +
   v_cat_hogar_limpieza UUID;                                                                                                                                                                                                                    +
   v_cat_hogar_lavander_a UUID;                                                                                                                                                                                                                  +
   v_cat_hogar_mantenimiento UUID;                                                                                                                                                                                                               +
   v_cat_hogar_comunidad UUID;                                                                                                                                                                                                                   +
   v_cat_suministros_luz UUID;                                                                                                                                                                                                                   +
   v_cat_suministros_agua UUID;                                                                                                                                                                                                                  +
   v_cat_suministros_gas_butano UUID;                                                                                                                                                                                                            +
   v_cat_suministros_internet UUID;                                                                                                                                                                                                              +
   v_cat_suministros_tel_fono UUID;                                                                                                                                                                                                              +
   v_cat_suministros_seguros UUID;                                                                                                                                                                                                               +
   v_cat_suministros_impuestos UUID;                                                                                                                                                                                                             +
   v_cat_alimentaci_n_supermercado UUID;                                                                                                                                                                                                         +
   v_cat_alimentaci_n_carnicer_a UUID;                                                                                                                                                                                                           +
   v_cat_alimentaci_n_restaurantes UUID;                                                                                                                                                                                                         +
   v_cat_alimentaci_n_pescader_a UUID;                                                                                                                                                                                                           +
   v_cat_alimentaci_n_fruter_a UUID;                                                                                                                                                                                                             +
   v_cat_alimentaci_n_panader_a UUID;                                                                                                                                                                                                            +
   v_cat_alimentaci_n_otros_alimentos UUID;                                                                                                                                                                                                      +
   v_cat_transporte_transporte UUID;                                                                                                                                                                                                             +
   v_cat_transporte_combustible UUID;                                                                                                                                                                                                            +
   v_cat_transporte_parking UUID;                                                                                                                                                                                                                +
   v_cat_transporte_peajes UUID;                                                                                                                                                                                                                 +
   v_cat_personal_ropa UUID;                                                                                                                                                                                                                     +
   v_cat_personal_farmacia UUID;                                                                                                                                                                                                                 +
   v_cat_personal_belleza UUID;                                                                                                                                                                                                                  +
   v_cat_personal_gimnasio UUID;                                                                                                                                                                                                                 +
   v_cat_personal_salud UUID;                                                                                                                                                                                                                    +
   v_cat_personal_mascotas UUID;                                                                                                                                                                                                                 +
   v_cat_personal_calzado UUID;                                                                                                                                                                                                                  +
   v_cat_estilo_de_vida_ocio UUID;                                                                                                                                                                                                               +
   v_cat_estilo_de_vida_deportes UUID;                                                                                                                                                                                                           +
   v_cat_estilo_de_vida_educaci_n UUID;                                                                                                                                                                                                          +
   v_cat_estilo_de_vida_suscripciones UUID;                                                                                                                                                                                                      +
   v_cat_estilo_de_vida_regalos UUID;                                                                                                                                                                                                            +
   v_cat_finanzas_seguros UUID;                                                                                                                                                                                                                  +
   v_cat_finanzas_impuestos UUID;                                                                                                                                                                                                                +
   v_cat_finanzas_pr_stamo_personal UUID;                                                                                                                                                                                                        +
   v_cat_finanzas_reembolso_saldo_a_favor UUID;                                                                                                                                                                                                  +
   v_cat_finanzas_varios UUID;                                                                                                                                                                                                                   +
 BEGIN                                                                                                                                                                                                                                           +
                                                                                                                                                                                                                                                 +
   -- CREAR GRUPOS (9)                                                                                                                                                                                                                           +
   INSERT INTO category_parents (household_id, name, icon, type, display_order) VALUES (NEW.id, 'Ingresos Laborales', 'üí∞', 'income', 1) RETURNING id INTO v_parent_ingresos_laborales;                                                          +
   INSERT INTO category_parents (household_id, name, icon, type, display_order) VALUES (NEW.id, 'Otros Ingresos', 'üí∏', 'income', 2) RETURNING id INTO v_parent_otros_ingresos;                                                                  +
   INSERT INTO category_parents (household_id, name, icon, type, display_order) VALUES (NEW.id, 'Hogar', 'üè†', 'expense', 1) RETURNING id INTO v_parent_hogar;                                                                                   +
   INSERT INTO category_parents (household_id, name, icon, type, display_order) VALUES (NEW.id, 'Suministros', '‚ö°', 'expense', 2) RETURNING id INTO v_parent_suministros;                                                                       +
   INSERT INTO category_parents (household_id, name, icon, type, display_order) VALUES (NEW.id, 'Alimentaci√≥n', 'üõí', 'expense', 3) RETURNING id INTO v_parent_alimentaci_n;                                                                     +
   INSERT INTO category_parents (household_id, name, icon, type, display_order) VALUES (NEW.id, 'Transporte', 'üöó', 'expense', 4) RETURNING id INTO v_parent_transporte;                                                                         +
   INSERT INTO category_parents (household_id, name, icon, type, display_order) VALUES (NEW.id, 'Personal', 'üë§', 'expense', 5) RETURNING id INTO v_parent_personal;                                                                             +
   INSERT INTO category_parents (household_id, name, icon, type, display_order) VALUES (NEW.id, 'Estilo de Vida', 'üéØ', 'expense', 6) RETURNING id INTO v_parent_estilo_de_vida;                                                                 +
   INSERT INTO category_parents (household_id, name, icon, type, display_order) VALUES (NEW.id, 'Finanzas', 'üíº', 'expense', 7) RETURNING id INTO v_parent_finanzas;                                                                             +
                                                                                                                                                                                                                                                 +
   -- CREAR CATEGOR√çAS (50)                                                                                                                                                                                                                      +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order) VALUES (NEW.id, v_parent_ingresos_laborales, 'N√≥mina', 'üí∞', 'income', 1) RETURNING id INTO v_cat_ingresos_laborales_n_mina;                                +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order) VALUES (NEW.id, v_parent_ingresos_laborales, 'Freelance', 'üíº', 'income', 2) RETURNING id INTO v_cat_ingresos_laborales_freelance;                          +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order) VALUES (NEW.id, v_parent_ingresos_laborales, 'Bonus', 'üéâ', 'income', 3) RETURNING id INTO v_cat_ingresos_laborales_bonus;                                  +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order) VALUES (NEW.id, v_parent_otros_ingresos, 'Inversiones', 'üìà', 'income', 1) RETURNING id INTO v_cat_otros_ingresos_inversiones;                              +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order) VALUES (NEW.id, v_parent_otros_ingresos, 'Ventas', 'üè∑Ô∏è', 'income', 2) RETURNING id INTO v_cat_otros_ingresos_ventas;                                         +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order) VALUES (NEW.id, v_parent_otros_ingresos, 'Devoluciones', '‚Ü©Ô∏è', 'income', 3) RETURNING id INTO v_cat_otros_ingresos_devoluciones;                             +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order) VALUES (NEW.id, v_parent_otros_ingresos, 'Aportaci√≥n Cuenta Conjunta', 'üè¶', 'income', 4) RETURNING id INTO v_cat_otros_ingresos_aportaci_n_cuenta_conjunta;+
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order) VALUES (NEW.id, v_parent_otros_ingresos, 'Pago Pr√©stamo', 'üí≥', 'income', 5) RETURNING id INTO v_cat_otros_ingresos_pago_pr_stamo;                          +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order) VALUES (NEW.id, v_parent_otros_ingresos, 'Varios', '‚ûï', 'income', 99) RETURNING id INTO v_cat_otros_ingresos_varios;                                       +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order) VALUES (NEW.id, v_parent_hogar, 'Vivienda', 'üè†', 'expense', 1) RETURNING id INTO v_cat_hogar_vivienda;                                                     +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order) VALUES (NEW.id, v_parent_hogar, 'Menaje', 'ü™ë', 'expense', 2) RETURNING id INTO v_cat_hogar_menaje;                                                         +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order) VALUES (NEW.id, v_parent_hogar, 'Limpieza', 'üßπ', 'expense', 3) RETURNING id INTO v_cat_hogar_limpieza;                                                     +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order) VALUES (NEW.id, v_parent_hogar, 'Lavander√≠a', 'üß∫', 'expense', 4) RETURNING id INTO v_cat_hogar_lavander_a;                                                 +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order) VALUES (NEW.id, v_parent_hogar, 'Mantenimiento', 'üîß', 'expense', 5) RETURNING id INTO v_cat_hogar_mantenimiento;                                           +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order) VALUES (NEW.id, v_parent_hogar, 'Comunidad', 'üè¢', 'expense', 6) RETURNING id INTO v_cat_hogar_comunidad;                                                   +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order) VALUES (NEW.id, v_parent_suministros, 'Luz', 'üí°', 'expense', 1) RETURNING id INTO v_cat_suministros_luz;                                                   +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order) VALUES (NEW.id, v_parent_suministros, 'Agua', 'üíß', 'expense', 2) RETURNING id INTO v_cat_suministros_agua;                                                 +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order) VALUES (NEW.id, v_parent_suministros, 'Gas/Butano', 'üî•', 'expense', 3) RETURNING id INTO v_cat_suministros_gas_butano;                                     +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order) VALUES (NEW.id, v_parent_suministros, 'Internet', 'üì°', 'expense', 4) RETURNING id INTO v_cat_suministros_internet;                                         +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order) VALUES (NEW.id, v_parent_suministros, 'Tel√©fono', 'üìû', 'expense', 5) RETURNING id INTO v_cat_suministros_tel_fono;                                         +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order) VALUES (NEW.id, v_parent_suministros, 'Seguros', 'üõ°Ô∏è', 'expense', 6) RETURNING id INTO v_cat_suministros_seguros;                                            +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order) VALUES (NEW.id, v_parent_suministros, 'Impuestos', 'üìã', 'expense', 7) RETURNING id INTO v_cat_suministros_impuestos;                                       +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order) VALUES (NEW.id, v_parent_alimentaci_n, 'Supermercado', 'üõí', 'expense', 1) RETURNING id INTO v_cat_alimentaci_n_supermercado;                               +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order) VALUES (NEW.id, v_parent_alimentaci_n, 'Carnicer√≠a', 'ü•©', 'expense', 2) RETURNING id INTO v_cat_alimentaci_n_carnicer_a;                                   +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order) VALUES (NEW.id, v_parent_alimentaci_n, 'Restaurantes', 'üçΩÔ∏è', 'expense', 2) RETURNING id INTO v_cat_alimentaci_n_restaurantes;                                +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order) VALUES (NEW.id, v_parent_alimentaci_n, 'Pescader√≠a', 'üêü', 'expense', 3) RETURNING id INTO v_cat_alimentaci_n_pescader_a;                                   +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order) VALUES (NEW.id, v_parent_alimentaci_n, 'Fruter√≠a', 'üçé', 'expense', 4) RETURNING id INTO v_cat_alimentaci_n_fruter_a;                                       +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order) VALUES (NEW.id, v_parent_alimentaci_n, 'Panader√≠a', 'ü•ñ', 'expense', 5) RETURNING id INTO v_cat_alimentaci_n_panader_a;                                     +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order) VALUES (NEW.id, v_parent_alimentaci_n, 'Otros Alimentos', 'üç±', 'expense', 6) RETURNING id INTO v_cat_alimentaci_n_otros_alimentos;                         +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order) VALUES (NEW.id, v_parent_transporte, 'Transporte', 'üöó', 'expense', 1) RETURNING id INTO v_cat_transporte_transporte;                                       +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order) VALUES (NEW.id, v_parent_transporte, 'Combustible', '‚õΩ', 'expense', 2) RETURNING id INTO v_cat_transporte_combustible;                                     +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order) VALUES (NEW.id, v_parent_transporte, 'Parking', 'üÖøÔ∏è', 'expense', 3) RETURNING id INTO v_cat_transporte_parking;                                              +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order) VALUES (NEW.id, v_parent_transporte, 'Peajes', 'üõ£Ô∏è', 'expense', 4) RETURNING id INTO v_cat_transporte_peajes;                                                +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order) VALUES (NEW.id, v_parent_personal, 'Ropa', 'üëï', 'expense', 1) RETURNING id INTO v_cat_personal_ropa;                                                       +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order) VALUES (NEW.id, v_parent_personal, 'Farmacia', 'üíä', 'expense', 2) RETURNING id INTO v_cat_personal_farmacia;                                               +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order) VALUES (NEW.id, v_parent_personal, 'Belleza', 'üíÑ', 'expense', 2) RETURNING id INTO v_cat_personal_belleza;                                                 +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order) VALUES (NEW.id, v_parent_personal, 'Gimnasio', 'üèãÔ∏è', 'expense', 3) RETURNING id INTO v_cat_personal_gimnasio;                                                +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order) VALUES (NEW.id, v_parent_personal, 'Salud', 'üè•', 'expense', 3) RETURNING id INTO v_cat_personal_salud;                                                     +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order) VALUES (NEW.id, v_parent_personal, 'Mascotas', 'üê∂', 'expense', 4) RETURNING id INTO v_cat_personal_mascotas;                                               +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order) VALUES (NEW.id, v_parent_personal, 'Calzado', 'üëü', 'expense', 5) RETURNING id INTO v_cat_personal_calzado;                                                 +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order) VALUES (NEW.id, v_parent_estilo_de_vida, 'Ocio', 'üé≠', 'expense', 1) RETURNING id INTO v_cat_estilo_de_vida_ocio;                                           +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order) VALUES (NEW.id, v_parent_estilo_de_vida, 'Deportes', '‚öΩ', 'expense', 2) RETURNING id INTO v_cat_estilo_de_vida_deportes;                                   +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order) VALUES (NEW.id, v_parent_estilo_de_vida, 'Educaci√≥n', 'üìö', 'expense', 3) RETURNING id INTO v_cat_estilo_de_vida_educaci_n;                                 +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order) VALUES (NEW.id, v_parent_estilo_de_vida, 'Suscripciones', 'üì±', 'expense', 4) RETURNING id INTO v_cat_estilo_de_vida_suscripciones;                         +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order) VALUES (NEW.id, v_parent_estilo_de_vida, 'Regalos', 'üéÅ', 'expense', 5) RETURNING id INTO v_cat_estilo_de_vida_regalos;                                     +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order) VALUES (NEW.id, v_parent_finanzas, 'Seguros', 'üõ°Ô∏è', 'expense', 1) RETURNING id INTO v_cat_finanzas_seguros;                                                  +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order) VALUES (NEW.id, v_parent_finanzas, 'Impuestos', 'üìã', 'expense', 2) RETURNING id INTO v_cat_finanzas_impuestos;                                             +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order) VALUES (NEW.id, v_parent_finanzas, 'Pr√©stamo Personal', 'üí∞', 'expense', 3) RETURNING id INTO v_cat_finanzas_pr_stamo_personal;                             +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order) VALUES (NEW.id, v_parent_finanzas, 'Reembolso Saldo a Favor', '‚Ü©Ô∏è', 'expense', 4) RETURNING id INTO v_cat_finanzas_reembolso_saldo_a_favor;                  +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order) VALUES (NEW.id, v_parent_finanzas, 'Varios', '‚ûï', 'expense', 99) RETURNING id INTO v_cat_finanzas_varios;                                                  +
                                                                                                                                                                                                                                                 +
   -- CREAR SUBCATEGOR√çAS (55)                                                                                                                                                                                                                   +
   INSERT INTO subcategories (category_id, name, icon, display_order, created_at) VALUES (v_cat_alimentaci_n_restaurantes, 'Fast Food', 'üçü', 1, NOW());                                                                                         +
   INSERT INTO subcategories (category_id, name, icon, display_order, created_at) VALUES (v_cat_alimentaci_n_restaurantes, 'Cafeter√≠a', '‚òï', 2, NOW());                                                                                         +
   INSERT INTO subcategories (category_id, name, icon, display_order, created_at) VALUES (v_cat_alimentaci_n_restaurantes, 'Restaurante Medio', 'üçΩÔ∏è', 3, NOW());                                                                                  +
   INSERT INTO subcategories (category_id, name, icon, display_order, created_at) VALUES (v_cat_alimentaci_n_restaurantes, 'Restaurante Alto', 'üë®‚Äçüç≥', 4, NOW());                                                                                +
   INSERT INTO subcategories (category_id, name, icon, display_order, created_at) VALUES (v_cat_alimentaci_n_restaurantes, 'Delivery', 'üì¶', 5, NOW());                                                                                          +
   INSERT INTO subcategories (category_id, name, icon, display_order, created_at) VALUES (v_cat_alimentaci_n_restaurantes, 'Otros', 'üç¥', 99, NOW());                                                                                            +
   INSERT INTO subcategories (category_id, name, icon, display_order, created_at) VALUES (v_cat_alimentaci_n_supermercado, 'Mercadona', 'üõí', 1, NOW());                                                                                         +
   INSERT INTO subcategories (category_id, name, icon, display_order, created_at) VALUES (v_cat_alimentaci_n_supermercado, 'D√≠a', 'üè™', 2, NOW());                                                                                               +
   INSERT INTO subcategories (category_id, name, icon, display_order, created_at) VALUES (v_cat_alimentaci_n_supermercado, 'Jam√≥n', 'üçñ', 3, NOW());                                                                                             +
   INSERT INTO subcategories (category_id, name, icon, display_order, created_at) VALUES (v_cat_alimentaci_n_supermercado, 'Lidl', 'üè™', 4, NOW());                                                                                              +
   INSERT INTO subcategories (category_id, name, icon, display_order, created_at) VALUES (v_cat_alimentaci_n_supermercado, 'Carrefour', 'üõí', 5, NOW());                                                                                         +
   INSERT INTO subcategories (category_id, name, icon, display_order, created_at) VALUES (v_cat_alimentaci_n_supermercado, 'Alcampo', 'üõí', 6, NOW());                                                                                           +
   INSERT INTO subcategories (category_id, name, icon, display_order, created_at) VALUES (v_cat_alimentaci_n_supermercado, 'Ahorramas', 'üõí', 7, NOW());                                                                                         +
   INSERT INTO subcategories (category_id, name, icon, display_order, created_at) VALUES (v_cat_alimentaci_n_supermercado, 'Eroski', 'üõí', 8, NOW());                                                                                            +
   INSERT INTO subcategories (category_id, name, icon, display_order, created_at) VALUES (v_cat_alimentaci_n_supermercado, 'Otros', 'üõçÔ∏è', 9, NOW());                                                                                              +
   INSERT INTO subcategories (category_id, name, icon, display_order, created_at) VALUES (v_cat_hogar_lavander_a, 'Lavander√≠a', 'üß∫', 1, NOW());                                                                                                 +
   INSERT INTO subcategories (category_id, name, icon, display_order, created_at) VALUES (v_cat_hogar_lavander_a, 'Tintorer√≠a', 'üëî', 2, NOW());                                                                                                 +
   INSERT INTO subcategories (category_id, name, icon, display_order, created_at) VALUES (v_cat_hogar_lavander_a, 'Planchado', 'üëï', 3, NOW());                                                                                                  +
   INSERT INTO subcategories (category_id, name, icon, display_order, created_at) VALUES (v_cat_hogar_vivienda, 'Alquiler', 'üè†', 0, NOW());                                                                                                     +
   INSERT INTO subcategories (category_id, name, icon, display_order, created_at) VALUES (v_cat_hogar_vivienda, 'Comunidad', 'üè¢', 1, NOW());                                                                                                    +
   INSERT INTO subcategories (category_id, name, icon, display_order, created_at) VALUES (v_cat_hogar_vivienda, 'Alquiler + Comunidad', 'üè†', 2, NOW());                                                                                         +
   INSERT INTO subcategories (category_id, name, icon, display_order, created_at) VALUES (v_cat_suministros_agua, 'Canal Isabel II', 'üíß', 1, NOW());                                                                                            +
   INSERT INTO subcategories (category_id, name, icon, display_order, created_at) VALUES (v_cat_suministros_agua, 'Agbar', 'üíß', 2, NOW());                                                                                                      +
   INSERT INTO subcategories (category_id, name, icon, display_order, created_at) VALUES (v_cat_suministros_agua, 'Otros', 'üíß', 99, NOW());                                                                                                     +
   INSERT INTO subcategories (category_id, name, icon, display_order, created_at) VALUES (v_cat_suministros_gas_butano, 'Butano', '‚õΩ', 1, NOW());                                                                                               +
   INSERT INTO subcategories (category_id, name, icon, display_order, created_at) VALUES (v_cat_suministros_gas_butano, 'Gas Natural', 'üî•', 2, NOW());                                                                                          +
   INSERT INTO subcategories (category_id, name, icon, display_order, created_at) VALUES (v_cat_suministros_gas_butano, 'Otros', '‚õΩ', 99, NOW());                                                                                               +
   INSERT INTO subcategories (category_id, name, icon, display_order, created_at) VALUES (v_cat_suministros_internet, 'Vodafone', 'üì°', 1, NOW());                                                                                               +
   INSERT INTO subcategories (category_id, name, icon, display_order, created_at) VALUES (v_cat_suministros_internet, 'Movistar', 'üì°', 2, NOW());                                                                                               +
   INSERT INTO subcategories (category_id, name, icon, display_order, created_at) VALUES (v_cat_suministros_internet, 'Orange', 'üì°', 3, NOW());                                                                                                 +
   INSERT INTO subcategories (category_id, name, icon, display_order, created_at) VALUES (v_cat_suministros_internet, 'Yoigo', 'üì°', 4, NOW());                                                                                                  +
   INSERT INTO subcategories (category_id, name, icon, display_order, created_at) VALUES (v_cat_suministros_internet, 'M√°sM√≥vil', 'üì°', 5, NOW());                                                                                               +
   INSERT INTO subcategories (category_id, name, icon, display_order, created_at) VALUES (v_cat_suministros_internet, 'Otros', 'üì°', 99, NOW());                                                                                                 +
   INSERT INTO subcategories (category_id, name, icon, display_order, created_at) VALUES (v_cat_suministros_luz, 'Iberdrola', '‚ö°', 1, NOW());                                                                                                   +
   INSERT INTO subcategories (category_id, name, icon, display_order, created_at) VALUES (v_cat_suministros_luz, 'Endesa', '‚ö°', 2, NOW());                                                                                                      +
   INSERT INTO subcategories (category_id, name, icon, display_order, created_at) VALUES (v_cat_suministros_luz, 'Naturgy', '‚ö°', 3, NOW());                                                                                                     +
   INSERT INTO subcategories (category_id, name, icon, display_order, created_at) VALUES (v_cat_suministros_luz, 'Repsol', '‚ö°', 4, NOW());                                                                                                      +
   INSERT INTO subcategories (category_id, name, icon, display_order, created_at) VALUES (v_cat_suministros_luz, 'Otros', '‚ö°', 99, NOW());                                                                                                      +
   INSERT INTO subcategories (category_id, name, icon, display_order, created_at) VALUES (v_cat_suministros_tel_fono, 'Vodafone', 'üì±', 1, NOW());                                                                                               +
   INSERT INTO subcategories (category_id, name, icon, display_order, created_at) VALUES (v_cat_suministros_tel_fono, 'Movistar', 'üì±', 2, NOW());                                                                                               +
   INSERT INTO subcategories (category_id, name, icon, display_order, created_at) VALUES (v_cat_suministros_tel_fono, 'Orange', 'üì±', 3, NOW());                                                                                                 +
   INSERT INTO subcategories (category_id, name, icon, display_order, created_at) VALUES (v_cat_suministros_tel_fono, 'Yoigo', 'üì±', 4, NOW());                                                                                                  +
   INSERT INTO subcategories (category_id, name, icon, display_order, created_at) VALUES (v_cat_suministros_tel_fono, 'Otros', 'üì±', 99, NOW());                                                                                                 +
   INSERT INTO subcategories (category_id, name, icon, display_order, created_at) VALUES (v_cat_transporte_transporte, 'Gasolina', '‚õΩ', 1, NOW());                                                                                              +
   INSERT INTO subcategories (category_id, name, icon, display_order, created_at) VALUES (v_cat_transporte_transporte, 'Diesel', '‚õΩ', 2, NOW());                                                                                                +
   INSERT INTO subcategories (category_id, name, icon, display_order, created_at) VALUES (v_cat_transporte_transporte, 'El√©ctrico', 'üîå', 3, NOW());                                                                                             +
   INSERT INTO subcategories (category_id, name, icon, display_order, created_at) VALUES (v_cat_transporte_transporte, 'Metro', 'üöá', 4, NOW());                                                                                                 +
   INSERT INTO subcategories (category_id, name, icon, display_order, created_at) VALUES (v_cat_transporte_transporte, 'Bus', 'üöå', 5, NOW());                                                                                                   +
   INSERT INTO subcategories (category_id, name, icon, display_order, created_at) VALUES (v_cat_transporte_transporte, 'Taxi/VTC', 'üöï', 6, NOW());                                                                                              +
   INSERT INTO subcategories (category_id, name, icon, display_order, created_at) VALUES (v_cat_transporte_transporte, 'Parking', 'üÖøÔ∏è', 7, NOW());                                                                                                +
   INSERT INTO subcategories (category_id, name, icon, display_order, created_at) VALUES (v_cat_transporte_transporte, 'Peajes', 'üõ£Ô∏è', 8, NOW());                                                                                                 +
   INSERT INTO subcategories (category_id, name, icon, display_order, created_at) VALUES (v_cat_transporte_transporte, 'Mantenimiento Veh√≠culo', 'üîß', 9, NOW());                                                                                +
   INSERT INTO subcategories (category_id, name, icon, display_order, created_at) VALUES (v_cat_transporte_transporte, 'ITV', 'üîç', 10, NOW());                                                                                                  +
   INSERT INTO subcategories (category_id, name, icon, display_order, created_at) VALUES (v_cat_transporte_transporte, 'Seguro Coche', 'üõ°Ô∏è', 11, NOW());                                                                                          +
   INSERT INTO subcategories (category_id, name, icon, display_order, created_at) VALUES (v_cat_transporte_transporte, 'Otros', 'üöó', 99, NOW());                                                                                                +
                                                                                                                                                                                                                                                 +
   RETURN NEW;                                                                                                                                                                                                                                   +
 END;                                                                                                                                                                                                                                            +
 $function$                                                                                                                                                                                                                                      +
 
 CREATE OR REPLACE FUNCTION public.create_default_household_categories(p_household_id uuid)                                                                                                                                                      +
  RETURNS void                                                                                                                                                                                                                                   +
  LANGUAGE plpgsql                                                                                                                                                                                                                               +
 AS $function$                                                                                                                                                                                                                                   +
 DECLARE                                                                                                                                                                                                                                         +
   v_grupo_hogar UUID;                                                                                                                                                                                                                           +
   v_grupo_suministros UUID;                                                                                                                                                                                                                     +
   v_grupo_alimentacion UUID;                                                                                                                                                                                                                    +
   v_grupo_transporte UUID;                                                                                                                                                                                                                      +
   v_grupo_ocio UUID;                                                                                                                                                                                                                            +
   v_grupo_salud UUID;                                                                                                                                                                                                                           +
   v_grupo_educacion UUID;                                                                                                                                                                                                                       +
   v_grupo_ropa UUID;                                                                                                                                                                                                                            +
   v_grupo_otros UUID;                                                                                                                                                                                                                           +
                                                                                                                                                                                                                                                 +
   v_categoria_vivienda UUID;                                                                                                                                                                                                                    +
   v_categoria_lavanderia UUID;                                                                                                                                                                                                                  +
   v_categoria_luz UUID;                                                                                                                                                                                                                         +
   v_categoria_agua UUID;                                                                                                                                                                                                                        +
   v_categoria_gas UUID;                                                                                                                                                                                                                         +
   v_categoria_internet UUID;                                                                                                                                                                                                                    +
   v_categoria_telefono UUID;                                                                                                                                                                                                                    +
   v_categoria_supermercado UUID;                                                                                                                                                                                                                +
   v_categoria_restaurantes UUID;                                                                                                                                                                                                                +
   v_categoria_transporte UUID;                                                                                                                                                                                                                  +
                                                                                                                                                                                                                                                 +
   -- NEW: Variables for categories without subcategories                                                                                                                                                                                        +
   v_categoria_comunidad UUID;                                                                                                                                                                                                                   +
   v_categoria_seguros UUID;                                                                                                                                                                                                                     +
   v_categoria_impuestos UUID;                                                                                                                                                                                                                   +
   v_categoria_menaje UUID;                                                                                                                                                                                                                      +
   v_categoria_limpieza UUID;                                                                                                                                                                                                                    +
   v_categoria_mantenimiento UUID;                                                                                                                                                                                                               +
   v_categoria_ocio UUID;                                                                                                                                                                                                                        +
   v_categoria_deportes UUID;                                                                                                                                                                                                                    +
   v_categoria_suscripciones UUID;                                                                                                                                                                                                               +
   v_categoria_belleza UUID;                                                                                                                                                                                                                     +
   v_categoria_mascotas UUID;                                                                                                                                                                                                                    +
   v_categoria_regalos UUID;                                                                                                                                                                                                                     +
   v_categoria_varios_ocio UUID;                                                                                                                                                                                                                 +
   v_categoria_salud UUID;                                                                                                                                                                                                                       +
   v_categoria_educacion UUID;                                                                                                                                                                                                                   +
   v_categoria_ropa UUID;                                                                                                                                                                                                                        +
   v_categoria_calzado UUID;                                                                                                                                                                                                                     +
   v_categoria_varios_otros UUID;                                                                                                                                                                                                                +
                                                                                                                                                                                                                                                 +
   -- Variables for income categories                                                                                                                                                                                                            +
   v_categoria_nomina UUID;                                                                                                                                                                                                                      +
   v_categoria_freelance UUID;                                                                                                                                                                                                                   +
   v_categoria_inversiones UUID;                                                                                                                                                                                                                 +
   v_categoria_ventas UUID;                                                                                                                                                                                                                      +
   v_categoria_devoluciones UUID;                                                                                                                                                                                                                +
   v_categoria_aportacion UUID;                                                                                                                                                                                                                  +
   v_categoria_bonus UUID;                                                                                                                                                                                                                       +
   v_categoria_varios_income UUID;                                                                                                                                                                                                               +
                                                                                                                                                                                                                                                 +
 BEGIN                                                                                                                                                                                                                                           +
   -- 1. Insert category_parents (grupos)                                                                                                                                                                                                        +
   INSERT INTO category_parents (household_id, name, icon, type, display_order)                                                                                                                                                                  +
   VALUES                                                                                                                                                                                                                                        +
     (p_household_id, 'Hogar', 'üè†', 'expense', 1),                                                                                                                                                                                              +
     (p_household_id, 'Suministros', 'üí°', 'expense', 2),                                                                                                                                                                                        +
     (p_household_id, 'Alimentaci√≥n', 'üçΩÔ∏è', 'expense', 3),                                                                                                                                                                                        +
     (p_household_id, 'Transporte', 'üöó', 'expense', 4),                                                                                                                                                                                         +
     (p_household_id, 'Ocio', 'üé≠', 'expense', 5),                                                                                                                                                                                               +
     (p_household_id, 'Salud', 'üè•', 'expense', 6),                                                                                                                                                                                              +
     (p_household_id, 'Educaci√≥n', 'üìö', 'expense', 7),                                                                                                                                                                                          +
     (p_household_id, 'Ropa', 'üëï', 'expense', 8),                                                                                                                                                                                               +
     (p_household_id, 'Otros', '‚ûï', 'expense', 9);                                                                                                                                                                                              +
                                                                                                                                                                                                                                                 +
   -- Get parent IDs                                                                                                                                                                                                                             +
   SELECT id INTO v_grupo_hogar FROM category_parents WHERE household_id = p_household_id AND display_order = 1;                                                                                                                                 +
   SELECT id INTO v_grupo_suministros FROM category_parents WHERE household_id = p_household_id AND display_order = 2;                                                                                                                           +
   SELECT id INTO v_grupo_alimentacion FROM category_parents WHERE household_id = p_household_id AND display_order = 3;                                                                                                                          +
   SELECT id INTO v_grupo_transporte FROM category_parents WHERE household_id = p_household_id AND display_order = 4;                                                                                                                            +
   SELECT id INTO v_grupo_ocio FROM category_parents WHERE household_id = p_household_id AND display_order = 5;                                                                                                                                  +
   SELECT id INTO v_grupo_salud FROM category_parents WHERE household_id = p_household_id AND display_order = 6;                                                                                                                                 +
   SELECT id INTO v_grupo_educacion FROM category_parents WHERE household_id = p_household_id AND display_order = 7;                                                                                                                             +
   SELECT id INTO v_grupo_ropa FROM category_parents WHERE household_id = p_household_id AND display_order = 8;                                                                                                                                  +
   SELECT id INTO v_grupo_otros FROM category_parents WHERE household_id = p_household_id AND display_order = 9;                                                                                                                                 +
                                                                                                                                                                                                                                                 +
   -- 2. Insert categories with RETURNING to capture IDs                                                                                                                                                                                         +
                                                                                                                                                                                                                                                 +
   -- HOGAR categories                                                                                                                                                                                                                           +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order)                                                                                                                                                             +
   VALUES                                                                                                                                                                                                                                        +
     (p_household_id, v_grupo_hogar, 'Vivienda', 'üè†', 'expense', 1),                                                                                                                                                                            +
     (p_household_id, v_grupo_hogar, 'Lavander√≠a', 'üß∫', 'expense', 4)                                                                                                                                                                           +
   RETURNING id INTO v_categoria_vivienda, v_categoria_lavanderia;                                                                                                                                                                               +
                                                                                                                                                                                                                                                 +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order)                                                                                                                                                             +
   VALUES                                                                                                                                                                                                                                        +
     (p_household_id, v_grupo_hogar, 'Comunidad', 'üè¢', 'expense', 2)                                                                                                                                                                            +
   RETURNING id INTO v_categoria_comunidad;                                                                                                                                                                                                      +
                                                                                                                                                                                                                                                 +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order)                                                                                                                                                             +
   VALUES                                                                                                                                                                                                                                        +
     (p_household_id, v_grupo_hogar, 'Seguros', 'üõ°Ô∏è', 'expense', 3)                                                                                                                                                                               +
   RETURNING id INTO v_categoria_seguros;                                                                                                                                                                                                        +
                                                                                                                                                                                                                                                 +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order)                                                                                                                                                             +
   VALUES                                                                                                                                                                                                                                        +
     (p_household_id, v_grupo_hogar, 'Impuestos', 'üìã', 'expense', 5)                                                                                                                                                                            +
   RETURNING id INTO v_categoria_impuestos;                                                                                                                                                                                                      +
                                                                                                                                                                                                                                                 +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order)                                                                                                                                                             +
   VALUES                                                                                                                                                                                                                                        +
     (p_household_id, v_grupo_hogar, 'Menaje', 'ü™ë', 'expense', 6)                                                                                                                                                                               +
   RETURNING id INTO v_categoria_menaje;                                                                                                                                                                                                         +
                                                                                                                                                                                                                                                 +
   -- SUMINISTROS categories                                                                                                                                                                                                                     +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order)                                                                                                                                                             +
   VALUES                                                                                                                                                                                                                                        +
     (p_household_id, v_grupo_suministros, 'Luz', 'üí°', 'expense', 1),                                                                                                                                                                           +
     (p_household_id, v_grupo_suministros, 'Agua', 'ÔøΩÔøΩ', 'expense', 2),                                                                                                                                                                          +
     (p_household_id, v_grupo_suministros, 'Gas/Butano', 'üî•', 'expense', 3),                                                                                                                                                                    +
     (p_household_id, v_grupo_suministros, 'Internet', 'üì°', 'expense', 4),                                                                                                                                                                      +
     (p_household_id, v_grupo_suministros, 'Tel√©fono', 'üìû', 'expense', 5)                                                                                                                                                                       +
   RETURNING id INTO v_categoria_luz, v_categoria_agua, v_categoria_gas, v_categoria_internet, v_categoria_telefono;                                                                                                                             +
                                                                                                                                                                                                                                                 +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order)                                                                                                                                                             +
   VALUES                                                                                                                                                                                                                                        +
     (p_household_id, v_grupo_suministros, 'Limpieza', 'üßπ', 'expense', 6)                                                                                                                                                                       +
   RETURNING id INTO v_categoria_limpieza;                                                                                                                                                                                                       +
                                                                                                                                                                                                                                                 +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order)                                                                                                                                                             +
   VALUES                                                                                                                                                                                                                                        +
     (p_household_id, v_grupo_suministros, 'Mantenimiento', 'üîß', 'expense', 7)                                                                                                                                                                  +
   RETURNING id INTO v_categoria_mantenimiento;                                                                                                                                                                                                  +
                                                                                                                                                                                                                                                 +
   -- ALIMENTACI√ìN categories                                                                                                                                                                                                                    +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order)                                                                                                                                                             +
   VALUES                                                                                                                                                                                                                                        +
     (p_household_id, v_grupo_alimentacion, 'Supermercado', 'üõí', 'expense', 1),                                                                                                                                                                 +
     (p_household_id, v_grupo_alimentacion, 'Restaurantes', 'üçΩÔ∏è', 'expense', 2)                                                                                                                                                                   +
   RETURNING id INTO v_categoria_supermercado, v_categoria_restaurantes;                                                                                                                                                                         +
                                                                                                                                                                                                                                                 +
   -- TRANSPORTE categories                                                                                                                                                                                                                      +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order)                                                                                                                                                             +
   VALUES                                                                                                                                                                                                                                        +
     (p_household_id, v_grupo_transporte, 'Transporte', 'üöó', 'expense', 1)                                                                                                                                                                      +
   RETURNING id INTO v_categoria_transporte;                                                                                                                                                                                                     +
                                                                                                                                                                                                                                                 +
   -- OCIO categories                                                                                                                                                                                                                            +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order)                                                                                                                                                             +
   VALUES                                                                                                                                                                                                                                        +
     (p_household_id, v_grupo_ocio, 'Ocio', 'üé≠', 'expense', 1)                                                                                                                                                                                  +
   RETURNING id INTO v_categoria_ocio;                                                                                                                                                                                                           +
                                                                                                                                                                                                                                                 +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order)                                                                                                                                                             +
   VALUES                                                                                                                                                                                                                                        +
     (p_household_id, v_grupo_ocio, 'Deportes', '‚öΩ', 'expense', 2)                                                                                                                                                                              +
   RETURNING id INTO v_categoria_deportes;                                                                                                                                                                                                       +
                                                                                                                                                                                                                                                 +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order)                                                                                                                                                             +
   VALUES                                                                                                                                                                                                                                        +
     (p_household_id, v_grupo_ocio, 'Suscripciones', 'üì±', 'expense', 3)                                                                                                                                                                         +
   RETURNING id INTO v_categoria_suscripciones;                                                                                                                                                                                                  +
                                                                                                                                                                                                                                                 +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order)                                                                                                                                                             +
   VALUES                                                                                                                                                                                                                                        +
     (p_household_id, v_grupo_ocio, 'Belleza', 'üíÑ', 'expense', 4)                                                                                                                                                                               +
   RETURNING id INTO v_categoria_belleza;                                                                                                                                                                                                        +
                                                                                                                                                                                                                                                 +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order)                                                                                                                                                             +
   VALUES                                                                                                                                                                                                                                        +
     (p_household_id, v_grupo_ocio, 'Mascotas', 'üê∂', 'expense', 5)                                                                                                                                                                              +
   RETURNING id INTO v_categoria_mascotas;                                                                                                                                                                                                       +
                                                                                                                                                                                                                                                 +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order)                                                                                                                                                             +
   VALUES                                                                                                                                                                                                                                        +
     (p_household_id, v_grupo_ocio, 'Regalos', 'üéÅ', 'expense', 6)                                                                                                                                                                               +
   RETURNING id INTO v_categoria_regalos;                                                                                                                                                                                                        +
                                                                                                                                                                                                                                                 +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order)                                                                                                                                                             +
   VALUES                                                                                                                                                                                                                                        +
     (p_household_id, v_grupo_ocio, 'Varios', '‚ûï', 'expense', 99)                                                                                                                                                                               +
   RETURNING id INTO v_categoria_varios_ocio;                                                                                                                                                                                                    +
                                                                                                                                                                                                                                                 +
   -- SALUD categories                                                                                                                                                                                                                           +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order)                                                                                                                                                             +
   VALUES                                                                                                                                                                                                                                        +
     (p_household_id, v_grupo_salud, 'Salud', 'üè•', 'expense', 1)                                                                                                                                                                                +
   RETURNING id INTO v_categoria_salud;                                                                                                                                                                                                          +
                                                                                                                                                                                                                                                 +
   -- EDUCACI√ìN categories                                                                                                                                                                                                                       +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order)                                                                                                                                                             +
   VALUES                                                                                                                                                                                                                                        +
     (p_household_id, v_grupo_educacion, 'Educaci√≥n', 'üìö', 'expense', 1)                                                                                                                                                                        +
   RETURNING id INTO v_categoria_educacion;                                                                                                                                                                                                      +
                                                                                                                                                                                                                                                 +
   -- ROPA categories                                                                                                                                                                                                                            +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order)                                                                                                                                                             +
   VALUES                                                                                                                                                                                                                                        +
     (p_household_id, v_grupo_ropa, 'Ropa', 'üëï', 'expense', 1)                                                                                                                                                                                  +
   RETURNING id INTO v_categoria_ropa;                                                                                                                                                                                                           +
                                                                                                                                                                                                                                                 +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order)                                                                                                                                                             +
   VALUES                                                                                                                                                                                                                                        +
     (p_household_id, v_grupo_ropa, 'Calzado', 'üëü', 'expense', 2)                                                                                                                                                                               +
   RETURNING id INTO v_categoria_calzado;                                                                                                                                                                                                        +
                                                                                                                                                                                                                                                 +
   -- OTROS categories                                                                                                                                                                                                                           +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order)                                                                                                                                                             +
   VALUES                                                                                                                                                                                                                                        +
     (p_household_id, v_grupo_otros, 'Varios', '‚ûï', 'expense', 99)                                                                                                                                                                              +
   RETURNING id INTO v_categoria_varios_otros;                                                                                                                                                                                                   +
                                                                                                                                                                                                                                                 +
   -- INCOME categories (no parent_id)                                                                                                                                                                                                           +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order)                                                                                                                                                             +
   VALUES                                                                                                                                                                                                                                        +
     (p_household_id, NULL, 'N√≥mina', 'üí∞', 'income', 1)                                                                                                                                                                                         +
   RETURNING id INTO v_categoria_nomina;                                                                                                                                                                                                         +
                                                                                                                                                                                                                                                 +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order)                                                                                                                                                             +
   VALUES                                                                                                                                                                                                                                        +
     (p_household_id, NULL, 'Freelance', 'üíº', 'income', 2)                                                                                                                                                                                      +
   RETURNING id INTO v_categoria_freelance;                                                                                                                                                                                                      +
                                                                                                                                                                                                                                                 +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order)                                                                                                                                                             +
   VALUES                                                                                                                                                                                                                                        +
     (p_household_id, NULL, 'Inversiones', 'üìà', 'income', 3)                                                                                                                                                                                    +
   RETURNING id INTO v_categoria_inversiones;                                                                                                                                                                                                    +
                                                                                                                                                                                                                                                 +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order)                                                                                                                                                             +
   VALUES                                                                                                                                                                                                                                        +
     (p_household_id, NULL, 'Ventas', 'üè∑Ô∏è', 'income', 4)                                                                                                                                                                                          +
   RETURNING id INTO v_categoria_ventas;                                                                                                                                                                                                         +
                                                                                                                                                                                                                                                 +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order)                                                                                                                                                             +
   VALUES                                                                                                                                                                                                                                        +
     (p_household_id, NULL, 'Devoluciones', '‚Ü©Ô∏è', 'income', 5)                                                                                                                                                                                    +
   RETURNING id INTO v_categoria_devoluciones;                                                                                                                                                                                                   +
                                                                                                                                                                                                                                                 +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order)                                                                                                                                                             +
   VALUES                                                                                                                                                                                                                                        +
     (p_household_id, NULL, 'Aportaci√≥n Cuenta Conjunta', 'üè¶', 'income', 6)                                                                                                                                                                     +
   RETURNING id INTO v_categoria_aportacion;                                                                                                                                                                                                     +
                                                                                                                                                                                                                                                 +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order)                                                                                                                                                             +
   VALUES                                                                                                                                                                                                                                        +
     (p_household_id, NULL, 'Bonus', 'üéâ', 'income', 7)                                                                                                                                                                                          +
   RETURNING id INTO v_categoria_bonus;                                                                                                                                                                                                          +
                                                                                                                                                                                                                                                 +
   INSERT INTO categories (household_id, parent_id, name, icon, type, display_order)                                                                                                                                                             +
   VALUES                                                                                                                                                                                                                                        +
     (p_household_id, NULL, 'Varios', '‚ûï', 'income', 99)                                                                                                                                                                                        +
   RETURNING id INTO v_categoria_varios_income;                                                                                                                                                                                                  +
                                                                                                                                                                                                                                                 +
   -- 3. Insert subcategories (EXISTING + NEW "Otros" for all)                                                                                                                                                                                   +
                                                                                                                                                                                                                                                 +
   -- Vivienda subcategories (existing + Otros)                                                                                                                                                                                                  +
   INSERT INTO subcategories (category_id, name, icon, display_order)                                                                                                                                                                            +
   VALUES                                                                                                                                                                                                                                        +
     (v_categoria_vivienda, 'Alquiler', 'üè†', 0),                                                                                                                                                                                                +
     (v_categoria_vivienda, 'Comunidad', 'üè¢', 1),                                                                                                                                                                                               +
     (v_categoria_vivienda, 'Alquiler + Comunidad', 'üè†', 2),                                                                                                                                                                                    +
     (v_categoria_vivienda, 'Otros', 'üì¶', 99);                                                                                                                                                                                                  +
                                                                                                                                                                                                                                                 +
   -- Lavander√≠a subcategories (existing + Otros)                                                                                                                                                                                                +
   INSERT INTO subcategories (category_id, name, icon, display_order)                                                                                                                                                                            +
   VALUES                                                                                                                                                                                                                                        +
     (v_categoria_lavanderia, 'Lavander√≠a', 'üß∫', 1),                                                                                                                                                                                            +
     (v_categoria_lavanderia, 'Tintorer√≠a', 'üëî', 2),                                                                                                                                                                                            +
     (v_categoria_lavanderia, 'Planchado', 'üëï', 3),                                                                                                                                                                                             +
     (v_categoria_lavanderia, 'Otros', 'üì¶', 99);                                                                                                                                                                                                +
                                                                                                                                                                                                                                                 +
   -- Luz subcategories (existing)                                                                                                                                                                                                               +
   INSERT INTO subcategories (category_id, name, icon, display_order)                                                                                                                                                                            +
   VALUES                                                                                                                                                                                                                                        +
     (v_categoria_luz, 'Iberdrola', '‚ö°', 1),                                                                                                                                                                                                    +
     (v_categoria_luz, 'Endesa', '‚ö°', 2),                                                                                                                                                                                                       +
     (v_categoria_luz, 'Naturgy', '‚ö°', 3),                                                                                                                                                                                                      +
     (v_categoria_luz, 'Repsol', '‚ö°', 4),                                                                                                                                                                                                       +
     (v_categoria_luz, 'Otros', '‚ö°', 99);                                                                                                                                                                                                       +
                                                                                                                                                                                                                                                 +
   -- Agua subcategories (existing)                                                                                                                                                                                                              +
   INSERT INTO subcategories (category_id, name, icon, display_order)                                                                                                                                                                            +
   VALUES                                                                                                                                                                                                                                        +
     (v_categoria_agua, 'Canal Isabel II', 'üíß', 1),                                                                                                                                                                                             +
     (v_categoria_agua, 'Agbar', 'üíß', 2),                                                                                                                                                                                                       +
     (v_categoria_agua, 'Otros', 'üíß', 99);                                                                                                                                                                                                      +
                                                                                                                                                                                                                                                 +
   -- Gas subcategories (existing)                                                                                                                                                                                                               +
   INSERT INTO subcategories (category_id, name, icon, display_order)                                                                                                                                                                            +
   VALUES                                                                                                                                                                                                                                        +
     (v_categoria_gas, 'Butano', '‚õΩ', 1),                                                                                                                                                                                                       +
     (v_categoria_gas, 'Gas Natural', 'üî•', 2),                                                                                                                                                                                                  +
     (v_categoria_gas, 'Otros', '‚õΩ', 99);                                                                                                                                                                                                       +
                                                                                                                                                                                                                                                 +
   -- Internet subcategories (existing)                                                                                                                                                                                                          +
   INSERT INTO subcategories (category_id, name, icon, display_order)                                                                                                                                                                            +
   VALUES                                                                                                                                                                                                                                        +
     (v_categoria_internet, 'Vodafone', 'üì°', 1),                                                                                                                                                                                                +
     (v_categoria_internet, 'Movistar', 'üì°', 2),                                                                                                                                                                                                +
     (v_categoria_internet, 'Orange', 'üì°', 3),                                                                                                                                                                                                  +
     (v_categoria_internet, 'Yoigo', 'üì°', 4),                                                                                                                                                                                                   +
     (v_categoria_internet, 'M√°sM√≥vil', 'üì°', 5),                                                                                                                                                                                                +
     (v_categoria_internet, 'Otros', 'üì°', 99);                                                                                                                                                                                                  +
                                                                                                                                                                                                                                                 +
   -- Tel√©fono subcategories (existing)                                                                                                                                                                                                          +
   INSERT INTO subcategories (category_id, name, icon, display_order)                                                                                                                                                                            +
   VALUES                                                                                                                                                                                                                                        +
     (v_categoria_telefono, 'Vodafone', 'üì±', 1),                                                                                                                                                                                                +
     (v_categoria_telefono, 'Movistar', 'üì±', 2),                                                                                                                                                                                                +
     (v_categoria_telefono, 'Orange', 'üì±', 3),                                                                                                                                                                                                  +
     (v_categoria_telefono, 'Yoigo', 'üì±', 4),                                                                                                                                                                                                   +
     (v_categoria_telefono, 'Otros', 'üì±', 99);                                                                                                                                                                                                  +
                                                                                                                                                                                                                                                 +
   -- Supermercado subcategories (existing + Otros)                                                                                                                                                                                              +
   INSERT INTO subcategories (category_id, name, icon, display_order)                                                                                                                                                                            +
   VALUES                                                                                                                                                                                                                                        +
     (v_categoria_supermercado, 'Mercadona', 'üõí', 1),                                                                                                                                                                                           +
     (v_categoria_supermercado, 'D√≠a', 'üè™', 2),                                                                                                                                                                                                 +
     (v_categoria_supermercado, 'Jam√≥n', 'üçñ', 3),                                                                                                                                                                                               +
     (v_categoria_supermercado, 'Lidl', 'üè™', 4),                                                                                                                                                                                                +
     (v_categoria_supermercado, 'Carrefour', 'üõí', 5),                                                                                                                                                                                           +
     (v_categoria_supermercado, 'Alcampo', 'üõí', 6),                                                                                                                                                                                             +
     (v_categoria_supermercado, 'Ahorramas', 'üõí', 7),                                                                                                                                                                                           +
     (v_categoria_supermercado, 'Eroski', 'üõí', 8),                                                                                                                                                                                              +
     (v_categoria_supermercado, 'Otros', 'ÔøΩÔøΩÔ∏è', 9);                                                                                                                                                                                               +
                                                                                                                                                                                                                                                 +
   -- Restaurantes subcategories (existing)                                                                                                                                                                                                      +
   INSERT INTO subcategories (category_id, name, icon, display_order)                                                                                                                                                                            +
   VALUES                                                                                                                                                                                                                                        +
     (v_categoria_restaurantes, 'Fast Food', 'üçü', 1),                                                                                                                                                                                           +
     (v_categoria_restaurantes, 'Cafeter√≠a', '‚òï', 2),                                                                                                                                                                                           +
     (v_categoria_restaurantes, 'Restaurante Medio', 'üçΩÔ∏è', 3),                                                                                                                                                                                    +
     (v_categoria_restaurantes, 'Restaurante Alto', 'üë®‚Äçüç≥', 4),                                                                                                                                                                                  +
     (v_categoria_restaurantes, 'Delivery', 'üì¶', 5),                                                                                                                                                                                            +
     (v_categoria_restaurantes, 'Otros', 'üç¥', 99);                                                                                                                                                                                              +
                                                                                                                                                                                                                                                 +
   -- Transporte subcategories (existing)                                                                                                                                                                                                        +
   INSERT INTO subcategories (category_id, name, icon, display_order)                                                                                                                                                                            +
   VALUES                                                                                                                                                                                                                                        +
     (v_categoria_transporte, 'Gasolina', '‚õΩ', 1),                                                                                                                                                                                              +
     (v_categoria_transporte, 'Diesel', '‚õΩ', 2),                                                                                                                                                                                                +
     (v_categoria_transporte, 'El√©ctrico', 'üîå', 3),                                                                                                                                                                                             +
     (v_categoria_transporte, 'Metro', 'üöá', 4),                                                                                                                                                                                                 +
     (v_categoria_transporte, 'Bus', 'üöå', 5),                                                                                                                                                                                                   +
     (v_categoria_transporte, 'Taxi/VTC', 'üöï', 6),                                                                                                                                                                                              +
     (v_categoria_transporte, 'Parking', 'üÖøÔ∏è', 7),                                                                                                                                                                                                +
     (v_categoria_transporte, 'Peajes', 'üõ£Ô∏è', 8),                                                                                                                                                                                                 +
     (v_categoria_transporte, 'Mantenimiento Veh√≠culo', 'üîß', 9),                                                                                                                                                                                +
     (v_categoria_transporte, 'ITV', 'üîç', 10),                                                                                                                                                                                                  +
     (v_categoria_transporte, 'Seguro Coche', 'üõ°Ô∏è', 11),                                                                                                                                                                                          +
     (v_categoria_transporte, 'Otros', 'üöó', 99);                                                                                                                                                                                                +
                                                                                                                                                                                                                                                 +
   -- ============================================================                                                                                                                                                                               +
   -- NEW: Add "Otros" subcategory to ALL categories without any                                                                                                                                                                                 +
   -- ============================================================                                                                                                                                                                               +
                                                                                                                                                                                                                                                 +
   INSERT INTO subcategories (category_id, name, icon, display_order)                                                                                                                                                                            +
   VALUES                                                                                                                                                                                                                                        +
     (v_categoria_comunidad, 'Otros', 'üì¶', 99),                                                                                                                                                                                                 +
     (v_categoria_seguros, 'Otros', 'üì¶', 99),                                                                                                                                                                                                   +
     (v_categoria_impuestos, 'Otros', 'üì¶', 99),                                                                                                                                                                                                 +
     (v_categoria_menaje, 'Otros', 'üì¶', 99),                                                                                                                                                                                                    +
     (v_categoria_limpieza, 'Otros', 'üì¶', 99),                                                                                                                                                                                                  +
     (v_categoria_mantenimiento, 'Otros', 'üì¶', 99),                                                                                                                                                                                             +
     (v_categoria_ocio, 'Otros', 'üì¶', 99),                                                                                                                                                                                                      +
     (v_categoria_deportes, 'Otros', 'üì¶', 99),                                                                                                                                                                                                  +
     (v_categoria_suscripciones, 'Otros', 'üì¶', 99),                                                                                                                                                                                             +
     (v_categoria_belleza, 'Otros', 'üì¶', 99),                                                                                                                                                                                                   +
     (v_categoria_mascotas, 'Otros', 'üì¶', 99),                                                                                                                                                                                                  +
     (v_categoria_regalos, 'Otros', 'üì¶', 99),                                                                                                                                                                                                   +
     (v_categoria_varios_ocio, 'Otros', 'üì¶', 99),                                                                                                                                                                                               +
     (v_categoria_salud, 'Otros', 'üì¶', 99),                                                                                                                                                                                                     +
     (v_categoria_educacion, 'Otros', 'üì¶', 99),                                                                                                                                                                                                 +
     (v_categoria_ropa, 'Otros', 'üì¶', 99),                                                                                                                                                                                                      +
     (v_categoria_calzado, 'Otros', 'üì¶', 99),                                                                                                                                                                                                   +
     (v_categoria_varios_otros, 'Otros', 'üì¶', 99),                                                                                                                                                                                              +
     (v_categoria_nomina, 'Otros', 'üì¶', 99),                                                                                                                                                                                                    +
     (v_categoria_freelance, 'Otros', 'üì¶', 99),                                                                                                                                                                                                 +
     (v_categoria_inversiones, 'Otros', 'üì¶', 99),                                                                                                                                                                                               +
     (v_categoria_ventas, 'Otros', 'üì¶', 99),                                                                                                                                                                                                    +
     (v_categoria_devoluciones, 'Otros', 'üì¶', 99),                                                                                                                                                                                              +
     (v_categoria_aportacion, 'Otros', 'üì¶', 99),                                                                                                                                                                                                +
     (v_categoria_bonus, 'Otros', 'üì¶', 99),                                                                                                                                                                                                     +
     (v_categoria_varios_income, 'Otros', 'üì¶', 99);                                                                                                                                                                                             +
                                                                                                                                                                                                                                                 +
   RAISE NOTICE '‚úÖ 9 grupos | 50 categor√≠as | 79 subcategor√≠as (55 existing + 24 new Otros)';                                                                                                                                                   +
 END;                                                                                                                                                                                                                                            +
 $function$                                                                                                                                                                                                                                      +
 
(2 rows)

